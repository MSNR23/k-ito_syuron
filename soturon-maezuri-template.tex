\input{tuat-common.tex}

\secret{m}{160mm}                 %学外秘/専攻外秘の設定．学部はb（学外秘），修士はm（専攻外秘）にする．
                                %第2引数は位置の調整用．-側に大きくすれば左に寄る．+側に大きくすれば右に寄る．
% \pagenum{1-9}%ページ番号 プログラムが確定したら修正を！

\newcommand{\FIGDIR}{./fig}	%図を置くディレクトリを指定する
				%Makefileとは連動していないので注意
\usepackage{pxjahyper} %% これを入れるとしおりが文字化けしない。out2uniが不要になる。
\usepackage{ikuo}%%便利コマンド集．
\usepackage{otf}
\usepackage[hang,small,bf]{caption}

\begin{document}
\twocolumn[%
\title{　\\投擲物の重さや身体のパラメータに応じた投擲フォーム戦略の研究}{Research on Throwing Form Strategies\\according toWeight of the Thrown Objects or Body Parameters}
\author{博士前期課程2年　伊藤浩平}{指導教員　水内郁夫　教授}{}
\begin{abstract}
This paper describes analysis of hoge and the hoge generator.  In previous researches, it was said that hoge is hoge.  In this research, we propose the idea ``hoge is not hoge''.  Based on this idea, we introduced the theory named ``The Second Law of Hoge'' and developed the hoge generator.  We confirmed the effect of the generator by simulations and experiments.  This is a pen.  This is a pen.  This is a pen.  This is a pen.  This is a pen.  This is a pen.  This is a pen.  This is a pen.  This is a pen.  This is a pen.  This is a pen.  This is a pen.  This is a pen.  This is a pen.  This is a pen.  This is a pen.  This is a pen.  This is a pen.  
\end{abstract}
\keyword{Hoge, Piyo, Design Criteria}
]
\begin{small}

\section{緒言}
投擲動作を行うスポーツは数多く存在するが，野球と砲丸投げのように競技によって投擲フォームは異なり，さらに同一競技内であっても個人によって投擲フォームは異なる．競技や個人によって投擲フォームが異なる要因として，投擲物や身体といった投擲フォームに関連するパラメータの違いが挙げられる．
具体的なパラメータとして，投擲物は重さや大きさ，身体は慣性や各部位のサイズ等がある．これまで投擲フォームに関する研究例として，眞田の野球におけるオーバーハンドスローとサイドハンドスローの球速の比較\cite{sanada}，大室らの野球における足の踏み出し幅による投球速度の比較\cite{omuro}，黒松らの砲丸投げグライド投法における投擲フォーム改善前後の飛距離の比較\cite{kuromatsu}などがある．
投擲フォームは球速や投擲物の飛距離等の，スポーツにおける総合性能に大きな影響を及ぼす．また，投擲に関する総合性能の研究例として，蔭山らの野球における体格や背筋力と投球速度の関係\cite{kageyama}，\UTF{9AD9}橋らの野球における肩関節と股関節の可動域・筋力と投球速度の関係\cite{takahashi}，坪井らの砲丸投げにおける投射速度・投射角と飛距離の関係\cite{tsuboi}などがある．スポーツにおいて総合性能向上は最も重要な要素の一つである．これらの研究はある一つの競技に特定した研究である．しかし，さまざまな投擲フォームがどのような戦略の基で成立しているのかに関する汎用的な理論は確立されていない．そこで，本研究ではシミュレーションにおいてさまざまなパラメータに応じた投擲フォームを導出・比較することで，さまざまな投擲フォームの戦略を検討・考察・議論することを目的とする．\\
\section{強化学習を用いた投擲フォーム導出}
投擲フォームの導出方法について，本研究では強化学習による最適化手法を採用した．\\
　投擲フォームは競技・個人によって異なる．また，多くの要素が同時に影響する複雑な動作であり，時々刻々と全身の運動連鎖\cite{iwasako}\cite{burkhart}によるダイナミクスが変化するため，明示的な解を求めることは困難である．運動連鎖とは，ある関節の動作が隣接する関節に影響を与え，運動エネルギーを伝達していく運動効果である．強化学習は複雑なモデルや学習プロセスにより最適化までに時間的計算コスト等はかかるが，明示的な解がなく詳細なパラメータ設定が求められる投擲フォーム導出において有効な手段である．
\subsection{強化学習}
強化学習\cite{rl1}\cite{rl2}とは，環境を観測しながらエージェントが試行錯誤することで，獲得する方策を最適化する機械学習の手法である．
方策とは，環境に対してエージェントがどのような行動を選択すべきかを決定する部分である．
強化学習の流れの概略図について，\figref{2.1.jpg}に示す．
\fig{2.1.jpg}{width=0.6\hsize}{Reinforcement Learning mechanism}
エージェントが環境に対して行動を選択し，実行する．環境はその行動に対しエージェントに状態と報酬をフィードバックする．
その後，エージェントは受け取った状態から報酬がより大きくなるような行動を選択する．\\
　この学習を繰り返すことでエージェントは行動を改善し，最適な行動を見つけることができる．
\subsection{強化学習手法}
本研究では，強化学習の手法の1つであるQ学習\cite{watkins}を採用する．Q学習とは，ある状態における，ある行動の価値をQ値と呼ばれる価値関数を用いて表す．
このQ値は短期的な報酬でなく，より報酬の高い状態へと遷移できるかを見据え，行動の長期的な価値を示すものである．\\
　Q学習において，Q値は\equref{1}で更新する．
\begin{eqnarray}
  \equlabel{1}
  Q(s,a)=(1-\alpha)Q(s,a)+\alpha(r+\gamma \mathrm{max}Q(s',a'))
\end{eqnarray}
\equref{1}において，$\alpha$は学習率，$\gamma$は割引率であり，範囲はそれぞれ0$\leq$$\alpha$$\leq$1，0$\leq$$\gamma$$\leq$1である．また，$Q(s,a)$は状態が$s$における行動$a$の行動価値関数である．学習率はQ値の更新の大きさを決定するパラメータであり，\equref{1}におけるQ値の更新量であるTD誤差$\alpha(r+\gamma \mathrm{max}Q(s',a'))$に影響する．学習率が極端に大きすぎるとQ値の更新が過剰となるため学習が発散する．一方，学習率が極端に小さすぎると学習の収束が遅くなり，局所的な最適解にとどまる可能性がある．そのため，Q学習において最適な学習率を設定することが重要である．割引率は将来の価値をどれだけ割り引くのかを決定するパラメータである．割引率が大きいほど長期的な報酬を重要視するため学習の収束に時間を要する．一方，割引率が小さいほど短期的な報酬を重要視するため，最適解に収束しない可能性がある．そのため，学習率と同様に最適な割引率を設定することが重要である．
\subsection{行動選択方法}
本研究では，行動選択方法として$\varepsilon$-greedy法\cite{greedy}を採用した．$\varepsilon$-greedy法とは，探索と活用のトレードオフを管理するための一般的な強化学習の手法である．
$\varepsilon$-greedy法では，$\varepsilon$（0$\leq$$\varepsilon$$\leq$1）の確率で全ての行動からランダムに行動を選択し，1-$\varepsilon$の確率でルールの価値が最も高い行動を選択する．
学習が進んでも$\varepsilon$が大きいと，無駄な探索が増加し学習効率が低下する．そのため，学習が進むにつれて$\varepsilon$を0に近づけることで，より学習したルールの価値に基づいた行動が選択できる．
\section{剛体1リンクによるリンク速度最適化シミュレーション}
本研究では自作したシミュレータを用いて投擲フォームを導出し，戦略を考察したが，検討に先立ち剛体1リンクモデルでのリンク速度最適化シミュレーションを行い，シミュレータと手法の妥当性について検証した．
\subsection{動力学モデル}
本章の検証で用いた動力学モデルである剛体１リンクを\figref{3.5.eps}に示す．$l$はリンク長さ、$l_g{1}$はリンクの重心までの長さ、$m$はリンク重さ、$I$は重心周りの慣性モーメント、$\tau$は関節にかかるトルク、$\theta$はリンク角度、$g$は重力加速度である。
\figt{3.5.eps}{width=0.6\hsize}{Rigid 1 Link}
\begin{table}[tb]
  \begin{center}
    \caption{Rigid 1 link parameters}
    \tablabel{3.1}
    \scalebox{0.8}[0.8]{
    \begin{tabular}{c|c|c}
      \hline
      Parameters & Unit & Values \\
      \hline
      $m$ & kg & 1.0 or 5.0 or 10.0\\
      $l$ & m & 1.00 \\
      $b$ &  & 0.01 \\
      \hline
    \end{tabular}
    }
  \end{center}
\end{table}
ラグランジュの方法\cite{lagrange}を用いて導いた剛体1リンクの運動方程式は，次の通りである．\\
\begin{eqnarray}
  \equlabel{2}
  M\ddot{\theta} + g(\theta) + b(\dot{\theta}) = \tau
\end{eqnarray}
% このとき，
% \begin{eqnarray}
%   M = I + m{l_{g}}^2
% \end{eqnarray}

% \begin{eqnarray}
%   g(\theta) = mgl_{g}\cos\theta
% \end{eqnarray}

% \begin{eqnarray}
%   b(\dot{\theta}) = b\dot{\theta}
% \end{eqnarray}
$M$は慣性項，$g(\theta)$は重力項，$b(\dot{\theta})$は粘性項である．
\subsection{シミュレータの作成}
剛体1リンクを強化学習するためのシミュレータをpythonで実装した．シミュレータでは導出した運動方程式をEuler法\cite{euler}により数値積分し運動学を解くことで，剛体1リンクの角度や角速度を計算した．Euler法は常微分方程式を解く手法の1つである．
Euler法の時間ステップは0.001 s とした．また，各エピソードごとに出力した時系列データを基に，pythonライブラリのmatplotlibによりリンク挙動をアニメーション表示するコードを作成した．
\figt{3.4.eps}{width=1.0\hsize}{Reward progress in Rigid 1 Link（1.0 kg，5.0 kg，10.0 kg）}
\figt{3.3.eps}{width=0.7\hsize}{Transition in angular velocity of Rigid 1 Link（1.0 kg，5.0 kg，10.0 kg）}
\subsection{強化学習の設定}
本章の強化学習を行うにあたって，状態，行動，報酬，その他を設定した．\\
状態について、Q学習はQ値をQテーブルと呼ばれる状態と行動で表される表に格納するため，連続値を離散化する必要がある．
状態変数は2つとし，リンクの角度$\theta$と角速度$\dot{\theta}$である．
角度の範囲は$-180$ deg $\leq \theta \leq$ $180$ deg，角速度の範囲は$-2.0$ m/s $\leq \dot{\theta} \leq$ $2.0$ m/sとした．
また，分割数は各状態4分割であり，全ての状態を$4^{2}$=16通りで表すことができる．
行動は，全3通りに設定した．回転ジョイントにかかるトルクの選択肢を$-5.0$ N$\cdot$m，$0$，$+5.0$ N$\cdot$mとし，いずれかを$\epsilon$-greedy法に基づき選択した．
報酬の設計について，\equref{3}に示す．リンクの角速度を報酬とすることで，リンクの角速度を大きくする設定とした．
\begin{eqnarray}
  \equlabel{3}
  reward = \dot{\theta}
\end{eqnarray}
その他の設定について，学習率$\alpha$=0.1，割引率$\gamma$=0.9とした．$\epsilon$は\equref{4}であり，エピソードが進むにつれてランダム値を選択する確率を小さくする設定とした．
\begin{eqnarray}
  \equlabel{4}
  \epsilon = 0.3 \times 0.99^{(\mathrm{episode} + 1)}
\end{eqnarray}
また，エピソード数を1000，時間ステップ$dt$を0.01，1エピソードあたりのステップ数を3000とし，30 s 間の剛体1リンクのリンク速度最適化シミュレーションを行った．
\subsection{リンク速度最適化シミュレーション}
パラメータの設定について，\tabref{3.1}に示す．$b$は粘性係数である．
% \begin{table}[t]
%   \begin{center}
%     \caption{Rigid 1 link parameters}
%     \tablabel{3.1}
%     \begin{tabular}{c|c|c}
%       \hline
%       Parameters & Unit & Values \\
%       \hline
%       $m$ & kg & 1.0 or 5.0 or 10.0\\
%       $l$ & m & 1.00 \\
%       $b$ &  & 0.01 \\
%       \hline
%     \end{tabular}
%   \end{center}
% \end{table}
リンクの重さは，1.0 kg，5.0 kg，10.0 kg の3種類とした．
\subsection{結果・考察}
初期条件は，$\theta$ = $-90$ deg ，$\dot{\theta}$ = 0 とした際の，リンク重さに応じたリンク速度最適化シミュレーションを行った結果について述べる．\figref{3.4.eps}はリンク重さ1.0 kg，5.0 kg，10.0 kg の際の報酬の遷移である．また，\figref{3.3.eps}はそれぞれのリンク重さの際の30 s 間のリンク速度の時系列を比較したグラフである．比較の結果，リンク重さによってリンク速度の推移に違いがみられた．特に，$m$=10.0 kg の際にトルクの入力は30秒間 $+ 5$ N$\cdot$m が選択され続けていたが，振動開始直後にややリンク速度が負となる瞬間がある．これはトルク不足の影響が考えられる．リンクを回転させる際，最もトルクが必要な姿勢はリンクを垂直下向きの位置から振り上げるタイミングである．本検証は剛体1リンクで自由度が1のため，他のリンクや関節による干渉を受けずリンクが回転し続けた．リンクや自由度が多くなると，他のリンクや関節による影響でリンク挙動に違いが生じると考えられる．\\
　本検証により，自作したシミュレータと手法の有用性を確認した．次章以降では，腕に見立てた剛体2リンクを動力学モデルとし，投擲フォームの導出・比較，戦略の考察を行う．

\section{2次元剛体2リンクによるパラメータに応じた投擲フォームの導出・比較と戦略の考察}
本章では，2次元モデルによる投擲物の重さに応じた遠投をするための投擲フォームの導出・比較により，考察した投擲フォーム戦略について述べる．同様に腕の長さに応じた遠投をするための投擲フォームの比較により，考察した投擲フォーム戦略について述べる．
\subsection{動力学モデル}
本章の検証で用いた動力学モデルを\figref{4.0.eps}に示す．人間の腕を肩関節1自由度と肘関節1自由度の計2自由度から構成される2次元剛体2リンクとしてモデル化した．$l_{1}$は上腕リンク長さ、$l_{2}$は前腕リンク長さ、$l_g{1}$は上腕リンクの重心までの長さ、$l_g{2}$は前腕リンクの重心までの長さ、$m_{1}$は上腕リンク重さ、$m_{2}$は前腕リンク重さ、$I_{1}$は上腕リンクの重心周りの慣性モーメント、$I_{2}$は前腕リンクの重心周りの慣性モーメント、$\tau_{1}$は肩関節にかかるトルク、$\tau_{2}$は肘関節にかかるトルク、$\theta_{1}$は上腕リンク角度、$\theta_{2}$は前腕リンク角度である。また、重力加速度は$g$である。ラグランジュの方法を用いて導いた2次元剛体2リンクの運動方程式は，次の通りである．
\figt{4.0.eps}{width=0.8\hsize}{2D Rigid 2 Links}
\begin{eqnarray}
  \equlabel{5}
  M(\theta)\ddot{\theta} + h(\theta, \dot{\theta}) + g(\theta) + b(\dot{\theta}) = \tau
\end{eqnarray}
このとき，$\theta$=${[\theta_{1} \quad \theta_{2}]}^T$，$\tau$=${[\tau_{1} \quad \tau_{2}]}^T$とし、$M(\theta)$は2$\times$2の慣性行列，$h(\theta, \dot{\theta})$は2$\times$1のコリオリ力の項，$g(\theta)$は2$\times$1の重力項，$b(\dot{\theta})$は2$\times$1の粘性項である．
% \begin{eqnarray}
%   M(\theta)= 
%               \begin{bmatrix}
%                 M_{11} & M_{12} \\
%                 M_{21} & M_{22}
%               \end{bmatrix}
% \end{eqnarray}

% \begin{eqnarray}
%   M_{11}= 
%             &&m_{1}{l_{g1}}^2 + I_{1} \nonumber \\
%             &+& m_{2}({l_{1}}^2 + {l_{g2}}^2 + 2l_{2}l_{g2}\cos\theta_{2}) + I_{2} \nonumber
% \end{eqnarray}
% \begin{eqnarray}
%   M_{12}= 
%   m_{2}({l_{g2}}^2 + l_{1}l_{g2}\cos\theta_{2}) + I_{2}\nonumber
% \end{eqnarray}
% \begin{eqnarray}
%   M_{21}= 
%   m_{2}({l_{g2}}^2 + l_{1}l_{g2}\cos\theta_{2}) + I_{2}\nonumber
% \end{eqnarray}
% \begin{eqnarray}
%   M_{22}= 
%   m_{2}{l_{g2}}^2 + I_{2}\nonumber
% \end{eqnarray}
% \begin{eqnarray}
%   h(\theta, \dot{\theta})=
%             \begin{bmatrix}
%               h_{11} \\
%               h_{21}
%             \end{bmatrix}
% \end{eqnarray}
% \begin{eqnarray}
%   h_{11}=
%   -m_{2}l_{1}l_{g2}\sin\theta_{2}(2\dot{\theta_{1}}\dot{\theta_{2}} + {\dot{\theta_{2}}}^2)\nonumber
% \end{eqnarray}
% \begin{eqnarray}
%   h_{21}=
%   m_{2}l_{1}l_{g2}\sin\theta_{2}\cdot{\dot{\theta_{1}}}^2\nonumber
% \end{eqnarray}
% \begin{eqnarray}
%   g(\theta)=
%   \begin{bmatrix}
%     g_{11} \\
%     g_{21}
%   \end{bmatrix}
% \end{eqnarray}
% \begin{eqnarray}
%   g_{11}=
%             &&m_{1}gl_{g1}\cos\theta_{1} \nonumber \\
%             &+& m_{2}g(l_{1}\cos\theta_{1} + l_{g2}\cos(\theta_{1} + \theta_{2}))\nonumber
% \end{eqnarray}
% \begin{eqnarray}
%   g_{21}=
%   m_{2}gl_{g2}\cos(\theta_{1} + \theta_{2})\nonumber
% \end{eqnarray}
% \begin{eqnarray}
%   b(\dot{\theta})=
%             \begin{bmatrix}
%               b_{11} \\
%               b_{21}
%             \end{bmatrix}
% \end{eqnarray}
% \begin{eqnarray}
%   b(\dot{\theta})=
%             \begin{bmatrix}
%               b_{1}\dot{\theta_{1}} \\
%               b_{2}\dot{\theta_{2}}
%             \end{bmatrix}
% \end{eqnarray}
\subsection{シミュレータの作成}
2次元剛体2リンクを強化学習するためのシミュレータをpythonで実装した．シミュレータでは導出した運動方程式をRunge-Kutta法\cite{runge-kutta}により数値積分し運動学を解くことで，2次元剛体2リンクの角度や角速度を計算する．Runge-Kutta法は常微分方程式を解く手法の1つであり，Euler法は時間幅$\Delta T$を1桁細かくすると誤差を1桁減少させるのに対し，Runge-Kutta方は誤差を4桁減少させることができる．
% \begin{table}[tb]
%   \begin{center}
%     \caption{Parameters which are used for 2D Rigid 2 Links simulation（0.14 kg vs 7.24 kg）}
%     \tablabel{4.1}
%     \scalebox{0.8}[0.8]{
%     \begin{tabular}{c|c|c|c}
%       \hline
%       Parameters & Unit & Values of 0.14 kg & Values of 7.24 kg \\
%       \hline
%       $l_{1}$ & m & 0.32 & 0.32\\
%       $l_{2}$ & m & 0.44 & 0.44\\
%       $l_{g1}$ & m & 0.16 & 0.16 \\
%       $l_{g2}$ & m & 0.21 & 0.40 \\
%       $m_{1}$ & kg & 1.96 & 1.96\\
%       $m_{2}$ & kg & 1.68 & 8.78 \\
%       $I_{1}$ & kg$\cdot$$\mathrm{m}^2$ & 0.017 & 0.017 \\
%       $I_{2}$ & kg$\cdot$$\mathrm{m}^2$ & 0.15 & 1.59 \\
%       $\tau_{1}$ & N$\cdot$m & $-16, 0, +16$ & $-47, 0, +47 $\\
%       $\tau_{2}$ & N$\cdot$m & $-10, 0, +10$ & $-41, 0, +41 $\\
%       $b_{1}$ &  & 0.05 & 0.05\\
%       $b_{2}$ &  & 0.01 & 0.01\\
%       \hline
%     \end{tabular}
%     }
%   \end{center}
% \end{table}
\subsection{強化学習の設定}
状態について、状態変数は4つとし，肩関節の角度$\theta_{1}$，角速度$\dot{\theta}_{1}$，肘関節の角度$\theta_{2}$，角速度$\dot{\theta}_{2}$とした．\\
各関節の角度の可動範囲は，$-180$ deg $\le$ $\theta_{1}$ $\le$ $180$ deg，$0$ $\le$ $\theta_{2}$ $\le$ $150$ deg\cite{range}とした．
肩関節は本来3自由度でありピッチ軸周りの可動範囲は設定した可動範囲より小さい．しかし，ロール軸，ヨー軸の可動範囲の影響により肩がピッチ軸周りに$360$ deg 回転しているように見える．よって，本章は2次元でのシミュレーションのため，上記の可動範囲とした．
また，各リンクの角速度については，$-10.0$ m/s $\le$ $\dot{\theta}_{1}$ $\le$ $10.0$ m/s，$-10.0$ m/s $\le$ $\dot{\theta}_{2}$ $\le$ $10.0$ m/sとした．
分割数は各状態4分割であり，全ての状態を$4^{4}$=256通りで表すことができる．\\
行動は，全9通りに設定した．肩関節にかかるトルクを正，0，負の3通り，同様に肘関節にかかるトルクも正，0，負の3通りとした．
これにより，Qテーブルは$256 \times 9=2304$通りで表すことができる．\\
報酬は，リリース時の投射角度$\theta_{v}$と手先速度$v_{2}$の2つの要素から設定した．リリースの投射角度$\theta_{v}$について，\equref{6}で計算し、条件により$\theta_{v}$が$45$ degまたは$135$ degの際に報酬最大となるよう設定した\cite{angle}。
\begin{eqnarray}
  \equlabel{6}
  \theta_{v}=\theta_{1}+\theta_{2}-90
\end{eqnarray}
\equref{6}において，$\theta_{v}$，$\theta_{1}$，$\theta_{2}$の単位はdegである．\\
　手先速度$v_{2}$について、\equref{7}で計算した。
% \begin{eqnarray}
%   \equlabel{2.20}
%   {v_{x2}}^2=-l_{1}\sin\theta_{1}\cdot\dot{\theta}_{1}-l_2\sin(\theta_{1}+\theta_{2})\cdot(\dot{\theta}_{1}+\dot{\theta}_{2})
% \end{eqnarray}
% \begin{eqnarray}
%   \equlabel{2.21}
%   {v_{y2}}^2=-l_{1}\cos\theta_{1}\cdot\dot{\theta}_{1}+l_2\cos(\theta_{1}+\theta_{2})\cdot(\dot{\theta}_{1}+\dot{\theta}_{2})
% \end{eqnarray}
% \equref{2.20}，\equref{2.21}より，
\begin{eqnarray}
  \equlabel{7}
  v_{2}=\sqrt{{v_{x2}}^2+{v_{y2}}^2}
\end{eqnarray}
以上の2つの要素より，報酬は$\theta_{v} \times v_{2}$と設定した．この設定により，遠投を行うための投擲フォームを獲得することができる．また，リリース時の投射角と手先速度の積とすることで，どちらの要素にも報酬に対する重みを付与することができる．\\
　さらに疲労を考慮した効率的な投擲フォームを獲得するために，罰則として累積消費エネルギーを採用した。各関節ごとの累積消費エネルギーを\equref{2.24}で計算し、その合計を全体の累積消費エネルギー$CE$とした．\equref{2.24}において、$\tau$は各関節に与えるトルクである．
\begin{eqnarray}
  \equlabel{8}
  CE_{j}&=&\int \tau_{j}(t)\cdot\dot{\theta}_{j} dt \nonumber \\
        &\approx&|\tau_{j}(t)\cdot\dot{\theta}_{j}|\cdot\Delta t \quad(j = 1,2)
\end{eqnarray}
% \begin{eqnarray}
%   \equlabel{2.24}
%   CE_{2}&=&\int \tau_{2}(t)\cdot\dot{\theta}_{2} dt \nonumber \\
%         &\approx&|\tau_{2}(t)\cdot\dot{\theta}_{2}|\cdot\Delta t
% \end{eqnarray}
% \equref{8}，\equref{2.24}より，
% \begin{eqnarray}
%   \equlabel{2.25}
%   CE = CE_{1} + CE_{2}
% \end{eqnarray}
以上をふまえ、報酬の設計を\equref{9}に示す。
\begin{eqnarray}
  \equlabel{9}
  Reward = \theta_{v} \times v_{2} - scale \times CE
\end{eqnarray}
\begin{table}[tb]
  \begin{center}
    \caption{Parameters which are used for 2D Rigid 2 Links simulation（0.14 kg vs 7.24 kg）}
    \tablabel{4.1}
    \scalebox{0.8}[0.8]{
    \begin{tabular}{c|c|c|c}
      \hline
      Parameters & Unit & Values of 0.14 kg & Values of 7.24 kg \\
      \hline
      $l_{1}$ & m & 0.32 & 0.32\\
      $l_{2}$ & m & 0.44 & 0.44\\
      $l_{g1}$ & m & 0.16 & 0.16 \\
      $l_{g2}$ & m & 0.21 & 0.40 \\
      $m_{1}$ & kg & 1.96 & 1.96\\
      $m_{2}$ & kg & 1.68 & 8.78 \\
      $I_{1}$ & kg$\cdot$$\mathrm{m}^2$ & 0.017 & 0.017 \\
      $I_{2}$ & kg$\cdot$$\mathrm{m}^2$ & 0.15 & 1.59 \\
      \hline
    \end{tabular}
    }
  \end{center}
\end{table}
\figt{4.2.eps}{width=0.9\hsize}{Reward progress in 2D Rigid 2 Links（left: 0.14 kg thrown object，right: 7.24 kg thrown object）}
である．
$scale$は累積消費エネルギーの値を調整するものである．累積消費エネルギーの値が大きすぎると1ステップごとの報酬が微小となる，あるいはマイナスとなっていくため，初期姿勢のまま動作せずエネルギー消費をしないことを最適として学習する．そのため$scale$によって累積消費エネルギーの大きさを調整する必要があるが，反対に$scale$が大きすぎて累積消費エネルギーが小さくなると疲労を考慮しない投擲フォームが導出されるため，値の調整が重要である．その他の設定について，\equref{1}における学習率$\alpha$を$0.1$，割引率$\gamma$を$0.9$に設定した．1タイムステップは$0.005$ sであり，1エピソード内のステップ数は2000，すなわち，$10$ sとした．エピソード数に関しては，学習が収束するまで際限なく行うものとした．

\subsection{投擲物の重さに応じた最適投擲フォームの比較}
身体のサイズは，身長 1.72 m，体重 70 kgの人間の各部位のサイズとした．投擲物は，野球の硬式球と砲丸の重さを参考に，$0.14$ kg\cite{horiuchi} と$7.24$ kg\cite{haq} とした．\\
重さ0.14 kg の投擲物と重さ7.24 kg の投擲物での学習の際に用いる各パラメータを\tabref{4.1}に示す\cite{irving}．重力加速度$g$を9.8 $\mathrm{m/s^{2}}$とする．また，本検証では前腕と手と投擲物の要素を合わせて前腕リンクとしてみなすため，3つの要素を考慮して設定を行った．肩関節に与えるトルクについて、重さ0.14 kg の際は$-16$ N$\cdot$m、0、16 N$\cdot$m、重さ7.24 kg の際は$-47$ N$\cdot$m、0、47 N$\cdot$mとした。また、肘関節に与えるトルクについて、重さ0.14 kg の際は$-10$ N$\cdot$m、0、10 N$\cdot$m、重さ7.24 kg の際は$-41$ N$\cdot$m、0、41 N$\cdot$mとした。さらに肘関節のトルクの設定において、肘関節の可動範囲は0 $\le$ $\theta_{2}$ $\le$ 150 deg であるが，可動範囲の端である$\theta_{2} = 0$ または $\theta_{2} = 150$ degでは，可動範囲内に戻ろうとする力がはたらく．これを考慮し，可動範囲の端では肘関節が可動範囲内に戻る方向に20 N$\cdot$m のトルクを加算する設定とした．各関節の粘性係数について、肩関節の粘性係数$b_{1}$は0.05、肘関節の粘性係数$b_{2}$は0.01とした。
以上の設定により，投擲物の重さに応じた遠投をするための投擲フォームの強化学習を行った際の報酬の遷移を\figref{4.2.eps}に示す．重さ0.14 kg の投擲物を遠投するための投擲フォームは1250エピソード，重さ7.24 kg の投擲物を遠投するための投擲フォームは4000エピソードを採用した．
\figt{4.3.eps}{width=0.8\hsize}{Throwing form from start to release of 2D Rigid 2 Links（0.14 kg thrown object，\\1.72 m tall human）}
\figt{4.4.eps}{width=0.8\hsize}{Throwing form from start to release of 2D Rigid 2 Links（7.24 kg thrown object，\\1.72 m tall human）}
\figt{4.5.eps}{width=0.8\hsize}{Transition of shoulder and elbow torque from start to release of 2D Rigid 2 Links\\（left: 0.14 kg thrown object，right: 7.24 kg thrown object）}
\figt{4.6.eps}{width=0.8\hsize}{Transition of shoulder and elbow angular velocity from start to release of 2D Rigid 2 Links（left: 0.14 kg thrown object，right: 7.24 kg thrown object）}
\begin{table}[h]
  \begin{center}
    \caption{Data at the release moment of 2D Rigid 2 Links（0.14 kg vs 7.24 kg）}
    \tablabel{4.3}
    \scalebox{0.80}[0.80]{
    \begin{tabular}{c|c|c|c}
      \hline
      Parameters & Unit & Values of 0.14 kg & Values of 7.24 kg \\
      \hline
      $\theta_{1}$ & deg & $-313.96$ & $-354.51$ \\
      $\theta_{2}$ & deg & 87.71 & 132.32 \\
      $v_{2}$ & m/s & 10.24 & 5.46 \\
      $\theta_{v}$ & deg & 43.76 & 47.81 \\
      \hline
    \end{tabular}
    }
  \end{center}
\end{table}
\subsection{結果・考察}
$\theta_{1}$，$\theta_{2}$，$\dot{\theta}_{1}$，$\dot{\theta}_{2}$の初期状態をいずれも0とした際の投擲物の重さに応じた遠投をするための投擲フォーム戦略の結果・考察について述べる．
\figref{4.3.eps}は強化学習により最適化した，重さ0.14 kg の投擲物を遠投するための投擲フォーム，\figref{4.4.eps}は強化学習により最適化した，重さ7.24 kg の投擲物を遠投するための投擲フォームである．投擲フォームは投擲開始からリリースまでとし，リリース時の姿勢は黒の太枠で囲まれたものである．図中の青リンク，橙リンクがそれぞれ上腕リンク，前腕リンクに対応し，赤線が手先の軌跡を示す．リリース瞬間の肩関節と肘関節の角度，手先速度，投射角を\tabref{4.3}に示す．2つの投擲フォームの比較により，リリース時の肩関節の角度と軌跡の径の大きさに違いがみられた．\\
　また，\figref{4.5.eps}は投擲開始からリリースまでの肩関節・肘関節のトルクの推移，\figref{4.6.eps}は投擲開始からリリースまでの肩関節・肘関節の角速度の推移である．\figref{4.5.eps}，\figref{4.6.eps}の左図が重さ0.14 kg の投擲物を遠投するための投擲フォームの各時系列，右図が重さ7.24 kg の投擲物を遠投するための投擲フォームの各時系列である．トルクの時系列より，重さ0.14 kg の投擲物を遠投するための投擲フォームは，肩関節と肘関節の運動連鎖を活かした投擲フォーム戦略の傾向がみられた．投擲開始からまず肩関節のトルクによって腕を回転させる．その後，約0.13 s で肩関節のトルクが腕の回転とは逆方向にトルクが生じ，肘関節のトルクが腕の回転と同方向にトルクが生じリリースを迎える．これは肩関節のエネルギーを肘関節に伝達することでより手先方向のエネルギーを大きくしていると考えられる．また，肩関節と肘関節の角速度の推移より，トルクの入力に運動連鎖の傾向がみられる約0.13 s から肩関節の角速度が減少し肘関節の角速度が増加する．リリース時には肩関節と肘関節の角速度が逆転していることから最後は前腕の振りを如何に大きくするのかが重要であると考えられる．一方，重さ7.24 kg の投擲物を遠投するための投擲フォームは，肩関節による影響が大きい投擲フォームの傾向がみられた．投擲開始から肩関節のトルクによって腕を回転させる傾向は重さ0.14 kg の投擲物の際と同様であるが，肩関節のトルクが0となる瞬間が数回生じ，また肘関節のトルクは肘を屈曲させる方向に生じ続けている．これは，肩関節のトルクによる腕の回転はペナルティである累積消費エネルギーへの影響が大きく，消費を抑制するためであると考えられる．また，肘関節のトルクによって肘を屈曲させ続ける傾向にある理由として，モーメントアームを小さくすることで肩の回転に消費するエネルギーを抑制するためであると考えられる．加えて肩関節と肘関節の角速度の推移より，肘関節の角速度が正となるのが遅く，リリースの瞬間も肩関節の角速度が肘関節の角速度より大きい．すなわち，肩関節の影響が重さ0.14 kg の投擲物を遠投する際よりも大きいと考えられる．\\
\subsection{腕の長さに応じた最適投擲フォームの比較}
身体のサイズは，身長1.72 m，体重70 kgの人間と，身長1.90 m，体重70 kg の各部位のサイズとした．
投擲物は，野球の硬式球を参考に，0.14 kgとした．
身長1.72 m の人間に基づいた腕の長さでの投擲の際と身長1.90 m の人間に基づいた腕の長さでの学習の際に用いる各パラメータを\tabref{4.2}に示す．重力加速度$g$を9.8 $\mathrm{m/s^{2}}$とする．また，本検証では投擲物の重さに応じた比較の際と同様に、前腕と手と投擲物の要素を合わせて前腕リンクとしてみなした．肩関節に与えるトルクについて、身長1.72 m の人間に基づいた腕の長さの際は$-16$ N$\cdot$m、0、16 N$\cdot$m、身長1.90 m の人間に基づいた腕の長さの際は$-18$ N$\cdot$m、0、18 N$\cdot$mとした。また、肘関節に与えるトルクについて、身長1.72 m の人間に基づいた腕の長さの際は$-10$ N$\cdot$m、0、10 N$\cdot$m、身長1.90 m の人間に基づいた腕の長さの際は$-11$ N$\cdot$m、0、11 N$\cdot$mとした。さらに肘関節の可動範囲の端のトルクの設定においては、投擲物の重さに応じた比較の際と同様の設定とした。各関節の粘性係数についても、投擲物の重さに応じた比較の際と同様の設定とした。
身長1.72 m の人間に基づいた腕の長さでの投擲の際と身長1.90 m の人間に基づいた腕の長さでの投擲の際の，それぞれの各リンクの重心までの長さ、慣性モーメント、各関節にかかるトルクを\tabref{4.5}に示す．重力加速度，可動範囲の端での肘関節に加算するトルクは，4.4.1節と同様の設定とした．
\begin{table}[tb]
  \begin{center}
    \caption{Parameters which are used for 2D Rigid 2 Links simulation（1.72 m vs 1.90 m）}
    \tablabel{4.4}
    \scalebox{0.8}[0.8]{
    \begin{tabular}{c|c|c|c}
      \hline
      Parameters & Unit & Values of 1.72 m & Values of 1.90 m \\
      \hline
      $l_{1}$ & m & 0.32 & 0.35 \\
      $l_{2}$ & m & 0.44 & 0.48 \\
      $l_{g1}$ & m & 0.16 & 0.18 \\
      $l_{g2}$ & m & 0.21 & 0.23 \\
      $m_{1}$ & kg & 1.96 & 1.96\\
      $m_{2}$ & kg & 1.68 & 1.68\\
      $I_{1}$ & kg$\cdot$$\mathrm{m}^2$ & 0.017 & 0.018 \\
      $I_{2}$ & kg$\cdot$$\mathrm{m}^2$ & 0.020 & 0.099 \\
      $\tau_{1}$ & N$\cdot$m & $-16, 0, +16$ & $-18, 0, +18$ \\
      $\tau_{2}$ & N$\cdot$m & $-10, 0, +10$ & $-11, 0, +11$ \\
      $b_{1}$ &  & 0.05 & 0.05\\
      $b_{2}$ &  & 0.01 & 0.01\\
      \hline
    \end{tabular}
    }
  \end{center}
\end{table}
以上の設定により、腕の長さに応じた投擲フォームの強化学習を行った際の報酬の遷移を\figref{4.4.eps}に示す．身長1.72 m の人間に基づいた腕の長さによる投擲フォームは1250エピソード，身長1.90 m の人間に基づいた腕の長さによる投擲フォームは2070エピソードを採用した．
\figt{4.7.eps}{width=1.0\hsize}{Reward progress in 2D Rigid 2 Links（left:1.72 m tall human，right:1.90 m tall human）}
\subsection{結果・考察}
$\theta_{1}$，$\theta_{2}$，$\dot{\theta}_{1}$，$\dot{\theta}_{2}$の初期状態をいずれも0とした際の腕の長さに応じた遠投をするための投擲フォーム戦略の結果・考察について述べる．
\figref{4.2.eps}は強化学習により最適化した，身長1.72 m の人間に基づいた腕の長さによる遠投をするための投擲フォーム，\figref{4.8.eps}は強化学習により最適化した，身長1.90 m の人間に基づいた腕の長さによる遠投をするための投擲フォームである．投擲フォームは投擲開始からリリースまでとし，リリース時の姿勢は黒の太枠で囲まれたものである．図中の青リンク，橙リンクがそれぞれ上腕リンク，前腕リンクに対応し，赤線が手先の軌跡を示す．リリース瞬間の肩関節と肘関節の角度，手先速度，投射角を\tabref{4.6}に示す．2つの投擲フォームの比較により，投擲物の重さによる比較と同様に，リリース時の肩関節の角度と軌跡の径の大きさに違いがみられた．
\begin{table}[tb]
  \begin{center}
    \caption{Data at the release moment of 2D Rigid 2 Links（1.72 m vs 1.90 m）}
    \tablabel{4.6}
    \scalebox{0.8}[0.8]{
    \begin{tabular}{c|c|c|c}
      \hline
      Parameters & Unit & Values of 1.72 m & Values of 1.90 m \\
      \hline
      $\theta_{1}$ & deg & $-313.96$ & $-338.49$ \\
      $\theta_{2}$ & deg & 87.71 & 119.67 \\
      $v_{2}$ & m/s & 10.24 & 13.95 \\
      $\theta_{v}$ & deg & 43.76 & 51.18 \\
      \hline
    \end{tabular}
    }
  \end{center}
\end{table}
また，\figref{4.9.eps}は投擲開始からリリースまでの肩関節・肘関節のトルクの推移，\figref{4.10.eps}は投擲開始からリリースまでの肩関節・肘関節の角速度の推移である．\figref{4.9.eps}，\figref{4.10.eps}の左図が身長1.72 m の人間に基づいた腕の長さによる遠投をするための投擲フォームの各時系列，右図が身長1.90 m の人間に基づいた腕の長さによる遠投をするための投擲フォームの各時系列である．\\
　トルクの時系列より，身長1.90 m の人間に基づいた腕の長さによる遠投をするための投擲フォームは，身長1.72 m の人間に基づいた腕の長さによる遠投をするための投擲フォームと同様に運動連鎖を活かした投擲フォーム戦略の傾向がみられた．しかし，投擲開始から肩関節のトルクによって腕を回転させる傾向は同様であるが，身長1.90 m の人間に基づいた腕の長さによる遠投をするための投擲フォームは肘関節のトルクを腕の回転方向とは反対の，肘関節を屈曲させる方向へ生じさせている．これはモーメントアームによる影響が考えられる．モーメントアームが大きいと腕の回転に必要な肩関節のトルクが大きくなるが，その分エネルギーを消費する．今回設定したトルクの大きさでは，肘を伸ばしたまま腕を回転させるよりも肘を屈曲してモーメントアームを小さくして腕を回転させる方がエネルギー消費が少なく腕を回転させることができると考えられる．また，腕の長さに問わずリリース時には肘関節の角速度が肩関節の角速度を上回ることから，リリース直前に運動連鎖によってより肘関節の角速度を大きくしようとすると考えられる．
\fig{4.8.eps}{width=0.8\hsize}{Throwing form from start to release of 2D Rigid 2 Links（0.14 kg thrown object，\\1.90 m tall human）}
\fig{4.9.eps}{width=1.0\hsize}{Transition of shoulder and elbow torque from start to release of 2D Rigid 2 Links（left:1.72 m tall human，right:1.90 m tall human）}
\fig{4.10.eps}{width=1.0\hsize}{Transition of shoulder and elbow angular velocity from start to release of 2D Rigid 2 Links（left:1.72 m tall human，right:1.90 m tall human）}

\section{3次元剛体2リンクによるパラメータに応じた投擲フォームの導出・比較と戦略の考察}
前章では2次元モデルでの投擲フォーム戦略の考察を行ったが，3次元に拡張することにより，より人間に近いモデルでの投擲フォーム戦略の考察が可能となると考えられる．そこで本章では，3次元モデルによる投擲物の重さに応じた遠投をするための投擲フォームの比較により，腕の長さに応じた遠投をするための投擲フォームの考察した投擲フォーム戦略について述べる．
\subsection{動力学モデル}
本章で用いた動力学モデルを\figref{5.1.eps}に示す．本章では，\figref{5.2.eps}で示す物理エンジンMuJoCo\cite{mujoco}\cite{mujoco2}に標準搭載されているhumanoidモデル「Unitree G1」\cite{unitreeg1}を改変し，人間の腕を肩関節3自由度と肘関節1自由度の計4自由度から構成される3次元剛体2リンクとしてモデル化した．なお，\figref{5.1.eps}において，肩関節から肘関節までを上腕リンク，肘関節から手先までを前腕リンクとし，手首や指の自由度は0とした．また，体幹リンクも自由度0とし，世界座標に固定した．
\fig{5.1.eps}{width=0.5\hsize}{3D Rigid 2 Links（stabilization of the trunk）}
\subsection{シミュレータの作成}
3次元剛体2リンクを強化学習するためのQ学習シミュレータをpythonで実装した．運動方程式は，MuJoCoで内部的に解いた．Runge-Kutta法により数値積分し運動学を解くことで，3次元剛体2リンクの角度や角速度を計算する．
\subsection{可動範囲}
本章における可動範囲を\tabref{5.1}に示す．角度の単位は deg である。それぞれの可動範囲は，肩関節ピッチ軸周りが$-135\leq\theta_{p}\leq45$、肩関節ロール軸周りが$-135\leq\theta_{r}\leq-35$、肩関節ヨー軸周りが$-150\leq\theta_{y}\leq180$、肘関節が$-20\leq\theta_{e}\leq90$とした。各自由度のそれぞれの静的な可動範囲\cite{range}を参考に設定した範囲である．\figref{5.6.eps}が各自由度0 deg の際の各平面からの姿勢であり，MuJoCoにおける回転方向は右ねじの法則に基づいて定義されている．各軸の回転方向は次の通りである．
\begin{itemize}
  \item 肩関節ピッチ軸周りの回転：肩関節の伸展方向が正，屈曲方向が負
  \item 肩関節ロール軸周りの回転：肩関節の内転方向が正，外転方向が負
  \item 肩関節ヨー軸周りの回転：肩関節の内旋方向が正，外旋方向が負
  \item 肘関節周りの回転：肩関節の伸展方向が正，屈曲方向が負
\end{itemize}
\tabref{5.1}の可動範囲を各自由度ごとに見ると，人間が可能な姿勢である．しかし人間の各関節は互いに干渉するため，組み合わせ次第では人間が不可能な姿勢となる．よって，肩関節ピッチ軸周り，ロール軸周り，ヨー軸周り，肘関節周りの順に，可動範囲を人間が可能な姿勢に収まるように設定した．\\
　まず，肩関節ピッチ軸周りの可動範囲に基づいた肩関節ロール軸周りの可動範囲について確認したところ，全ての可動範囲で人間が可能な姿勢であったため，そのまま可動範囲として採用した．次に肩関節ピッチ軸周りとロール軸周りに基づいた肩関節ヨー軸周りの可動範囲について確認したところ，組み合わせ次第で人間が不可能な姿勢を取ることを確認した．そこで，スプライン補間\cite{spline}を用いて肩関節ピッチ軸周りとロール軸周りの角度によって肩関節ヨー軸周りの可動範囲が変動するように設定した．最後に肩関節に基づいた肘関節について確認したところ，全ての可動範囲で人間が可能な姿勢であったため，そのまま可動範囲として設定した．以上の設定により，全ての関節角度の組み合わせで人間が可能な姿勢を取ることができる．なお，計算精度上，数 deg 可動範囲外の角度を取ることがあるが，異常姿勢ではないため問題ないとした．
\subsection{強化学習の設定}
状態について、状態変数は8つとし，肩関節ピッチ軸周りの角度$\theta_{p}$，角速度$\dot{\theta}_{p}$，肩関節ロール軸周りの角度$\theta_{r}$，角速度$\dot{\theta}_{r}$，肩関節ヨー軸周りの角度$\theta_{y}$，角速度$\dot{\theta}_{y}$，肘関節の角度$\theta_{e}$，角速度$\dot{\theta}_{e}$とした．
　各関節の角度については\tabref{5.1}の通りであり，肩関節ロール軸周りのみスプライン補間に基づく範囲とした．
また，各関節の角速度については，$-10.0$ m/s $\le$ $\dot{\theta}_{1}$ $\le$ 10.0 m/s，$-10.0$ m/s $\le$ $\dot{\theta}_{2}$ $\le$ 10.0 m/sとした．
分割数は各角度が5分割，各角速度が2分割であり，全ての状態を$5^{4}\times 2^{4}=10000$通りで表すことができる．\\
行動は，全625通りに設定した．肩の各関節にかかるトルクを正2通り，0，負2通りの計5通り，同様に肘関節にかかるトルクも正2通り，0，負2通りの計5通りとした．
これにより，Qテーブルは$10000 \times 625=6250000$通りで表すことができる．\\
報酬は投擲物の飛距離とした．投擲物のモデル化は行っていないため，投射中の投擲物に生じる空気抵抗等は考慮しないものとする．\\
飛距離の計算にあたり，ピッチ軸方向，ロール軸方向，ヨー軸方向の3方向成分の手先速度をMuJoCoより取得し，それぞれ$v_{p}$，$v_{r}$，$v_{y}$とした．手先速度3成分の合成$v_{syn}$は，
\begin{eqnarray}
  \equlabel{10}
  v_{syn} = \sqrt{{v_{p}}^{2} + {v_{r}}^{2} + {v_{y}}^{2}}
\end{eqnarray}
% また，ピッチ・ロール軸平面の手先速度成分の合成$v_{pr}$は，
% \begin{eqnarray}
%   \equlabel{5.2}
%   v_{pr} = \sqrt{{v_{p}}^{2} + {v_{r}}^{2}}
% \end{eqnarray}
であり，\equref{10}，\equref{5.2}より投射角$\theta_{v}$は，
\begin{eqnarray}
  \equlabel{11}
  \theta_{v} = \arctan2(\frac{v_{y}}{v_{pr}})
\end{eqnarray}
各ステップ時のヨー軸成分の座標$h_{y}$を手先高さとする．しかし，この座標は肩関節を原点とした際の値であり，本来の手先高さは地面から肩関節までの高さを考慮する必要がある．よって，身長を$L$とした際の手先高さ$h$は，
\begin{eqnarray}
  \equlabel{12}
  h = 0.818L + h_{y}
\end{eqnarray}
リリース時の手先高さを考慮した投射時間$t$は，
\begin{eqnarray}
  \equlabel{13}
  t = \frac{v_{syn}\sin\theta_{v} + \sqrt{{v_{syn}}^2\sin^2\theta_{syn} + 2gh}}{g}
\end{eqnarray}
以上より，飛距離$D$は\equref{10}，\equref{11}，\equref{13}を用いて，
\begin{eqnarray}
  \equlabel{14}
  D = v_{syn} \cdot \cos\theta_{v} \cdot t
\end{eqnarray}
また，2次元の際と同様に，罰則として累積消費エネルギーを採用し，\equref{5.11}で計算した．なお，$CE_{p},CE_{r},CE_{y}$はそれぞれ肩関節ピッチ軸周り，ロール軸周り，ヨー軸周りの累積消費エネルギーである．
$\tau_{e}$は肘関節に与えるトルクである．よって，全体の累積消費エネルギー$CE$は，
以上より，報酬の設計は，
\begin{eqnarray}
  \equlabel{15}
  Reward = D - scale \times CE
\end{eqnarray}
である．\\
その他の設定について，\equref{1}における学習率$\alpha$を0.1，割引率$\gamma$を0.9に設定した．1タイムステップは0.001 sであり，1エピソード内のステップ数は3000，すなわち，3 sとした．エピソード数に関しては，10000エピソードの中で最も報酬が高いエピソードを採用した．

\subsection{投擲物の重さに応じた最適投擲フォームの比較}
身体のサイズは，身長1.72 m，体重70 kgの人間の各部位のサイズとした．
投擲物は，野球の硬式球と砲丸の重さを参考に，0.14 kg と7.24 kg とした．
重さ0.14 kg の投擲物と重さ7.24 kg の投擲物での学習の際に用いる各パラメータの内、各関節に与えるトルクと粘性係数以外のパラメータは\tabref{4.1}に示された2次元剛体2リンクの際と同様とした．重力加速度$g$を9.8 $\mathrm{m/s}^{2}$とする．また，前章と同様に前腕と手と投擲物の要素を合わせて前腕リンクとしてみなした。肩関節3軸周りに与えるトルクについては、$-40$ N$\cdot$m、$-20$ N$\cdot$m、0、20 N$\cdot$m、40 N$\cdot$mのいずれかとした。また、肘関節に与えるトルクについては、$-30$ N$\cdot$m、$-15$ N$\cdot$m、0、15 N$\cdot$m、30 N$\cdot$mのいずれかから$\epsilon$-greedy法に基づいて選択したが、肩関節ヨー軸周りのトルクに関しては、スプライン補間によって設定した可動範囲に基づき，可動範囲内にトルクが収まるように与えるトルクも補完する設定とした．各関節の粘性係数について、肩関節ピッチ軸周りの粘性係数$b_{p}$は1.0、肩関節ロール軸周りの粘性係数$b_{r}$は0.8、肩関節ヨー軸周りの粘性係数$b_{y}$は0.5、肘関節の粘性係数$b_{e}$は0.2とした。
以上の設定をふまえ，投擲物に応じた遠投をするための投擲フォームの強化学習を行った際の報酬の遷移を\figref{5.9.eps}に示す．重さ0.14 kg の投擲物を遠投するための投擲フォームは2983エピソード，重さ7.24 kg の投擲物を遠投するための投擲フォームは9140エピソードを採用した．
\fig{5.9.eps}{width=1.0\hsize}{Reward progress in 3D Rigid 2 Links（left: 0.14 kg thrown object，right: 7.24 kg \newline thrown object）}
\subsection{結果・考察}
初期状態について，$\theta_{p}$，$\theta_{r}$，$\theta_{y}$，$\theta_{e}$はランダム値，$\dot{\theta}_{p}$，$\dot{\theta}_{r}$，$\dot{\theta}_{y}$，$\dot{\theta}_{e}$は0とした．これにより，最も報酬が高くなる際の初期姿勢を導出することができる．投擲物に応じた遠投するための投擲フォーム戦略の結果・考察について述べる．
\figref{5.11.eps}は強化学習により最適化した，ピッチ軸に垂直な面から見た際の重さ0.14 kg の投擲物を遠投するための投擲フォームである．また，\figref{5.13.eps}は強化学習により最適化した，ピッチ軸に垂直な面から見た際の重さ7.24 kg の投擲物を遠投するための投擲フォームである．リリース瞬間は，1エピソードの中で最も報酬が高いステップとした．投擲フォームは投擲開始からリリースまでとし，リリース瞬間の肩関節3軸周りと肘関節の角度，手先の高さ，手先速度，投射角，投擲物の飛距離を\tabref{5.4}に示す．重さ0.14 kg の投擲物を遠投するための投擲フォームのリリース瞬間は0.489 s，重さ7.24 kg の投擲物を遠投するための投擲フォームのリリース瞬間は0.447 sであった．
\begin{table}[tb]
  \begin{center}
    \caption{Data at the release moment of 3D Rigid 2 Links（0.14 kg vs 7.24 kg）}
    \tablabel{5.4}
    \scalebox{0.8}[0.8]{
    \begin{tabular}{c|c|c|c}
      \hline
      Parameters & Unit & Values of 0.14 kg & Values of 7.24 kg \\
      \hline
      $\theta_{p}$ & deg & $-125.11$ & $-97.58$ \\
      $\theta_{r}$ & deg & $-136.91$ & $-46.48$ \\
      $\theta_{y}$ & deg  & 36.30 & 0.00 \\
      $\theta_{e}$ & deg & $-23.52$ & 20.25 \\
      $h$ & m & 1.96 & 2.03 \\
      $v_{syn}$ & m/s & 26.00 & 6.80 \\
      $\theta_{v}$ & deg & 48.27 & 36.91 \\
      $D$ & m & 70.17 & 6.42 \\
      \hline
    \end{tabular}
    }
  \end{center}
\end{table}
\figref{5.7.eps}は投擲開始からリリースまでの肩関節3軸周り，肘関節周りのトルクの推移，\figref{5.21.eps}は投擲開始からリリースまでの手先速度の推移である．\figref{5.7.eps}，\figref{5.21.eps}において，左図は重さ0.14 kg の投擲物を遠投するための投擲フォームの各時系列，右図は重さ7.24 kg の投擲物を遠投するための投擲フォームの各時系列である．\\
　まず，重さ0.14 kg の投擲物を遠投するための投擲フォームについて述べる．初期姿勢は肘を伸ばして横に腕を広げた状態であったが，そこから主に肩関節ピッチ軸周りのトルクによって腕が後方に引かれている．その際，0.2 s あたりから，肘関節のトルクは肘が屈曲する方向へ入力される．その後，腕を引き切った0.35 s あたりから肩関節ヨー軸周りのトルクによって腕を前方と振り上げてリリースを迎える．その際肩関節ピッチ軸周りのトルクに注目すると正負の値を繰り返しているが，これは運動連鎖の活用の影響と考えられる．腕を前方に回転する際，肩関節ピッチ軸周りのトルクを腕の回転方向に入力し続けることで，より腕の回転に貢献できると考えられる．しかし，重力の影響で最も腕を回転させるためにトルクが必要な0.35 s あたりから腕の回転とは逆方向にトルクが入力されている．これは肩関節ピッチ軸周りの関節が持つエネルギーをヨー軸周りの関節に伝達していると考えられる．\\
　次に，重さ7.24 kg の投擲物を遠投するための投擲フォームについて述べる．初期姿勢は肘関節を屈曲させて腕を前方高く上げている．これは，慣性モーメントの影響が考えられる．重い投擲物を持って腕を後方へ回転させると慣性モーメントの影響で肩関節や肘関節にかかる負荷が大きい．そのため，あらかじめ手先位置の高い姿勢を取ることで腕を振り上げる動作を回避しようとしていると考えられる．投擲開始から腕を後方に引く動作は無く，主に肩関節ロール軸周りのトルクによって腕が前方へ動く．この際，肘関節は肘を屈曲させる方向へトルクが入力され続けており，慣性モーメントによる腕への負担を軽減しようとしていると考えられる．0.256 s あたりから肩関節ロール軸周りと肘関節のトルクの入力が負から正となり，ロール軸周りのトルクが正から負となる．これは，重さ0.14 kg の投擲物の際と同様に，運動連鎖による前腕へのエネルギーの伝達により，肘を伸展させるエネルギーを大きくしていると考えられる．その後リリースを迎えるが，投擲方向は正面ではなく左方向となった．これは，本検証で用いた動力学モデル手首の自由度が0であること，ロール軸方向に正であれば投擲方向は問わない報酬設定の影響があると考えられる．\\
　以上より，重さ0.14 kg の投擲物を遠投するための投擲フォームと重さ7.24 kg の投擲物を遠投するための投擲フォームの比較よりみられる戦略の違いは，「腕の押し出し度合い」であると考えられる．\figref{5.15.eps}は投擲開始からリリースまでの，肩を基準とした際の手先高さの推移である．\figref{5.15.eps}において，左図は重さ0.14 kg の投擲物を遠投するための投擲フォームの各時系列，右図は重さ7.24 kg の投擲物を遠投するための投擲フォームの各時系列である．重さ0.14 kg の投擲物の際はリリース前に一度手先が下がってから一気に高くなるが，重さ7.24 kg の投擲物の際はほぼ手先高さに変化がみられない．この波形の直線度が高いほど腕の押し出し度合いが高い．よって，重さ0.14 kg の投擲物を遠投するための投擲フォームは，運動連鎖による肩関節の回転を重要視した戦略が考えられる．一方，重さ7.24 kg の投擲物を遠投するための投擲フォームは，肘の伸展や前腕を重要視した腕の押し出し度合いの高い戦略が考えられる．
\fig{5.11.eps}{width=1.0\hsize}{Throwing form from start to release of 3D Rigid 2 Links from a plane perpendicular to the pitch axis（0.14 kg thrown object，1.72 m tall human）}
\fig{5.13.eps}{width=1.0\hsize}{Throwing form from start to release of 3D Rigid 2 Links from a plane perpendicular to the pitch axis（7.24 kg thrown object，1.72 m tall human）}
\fig{5.7.eps}{width=1.0\hsize}{Transition of shoulder 3 degrees of freedom and elbow 1 degree of freedom torque from start to release of 3D Rigid 2 Links（left: 0.14 kg thrown object，right: 7.24 kg thrown object）}
\fig{5.15.eps}{width=1.0\hsize}{Transition of hand height relative shoulder from start to release of 3D Rigid \newline 2 Links（left: 0.14 kg thrown object，right: 7.24 kg thrown object）}
\subsection{腕の長さに応じた最適投擲フォームの比較}
身体のサイズは，身長1.72 m，体重70 kgの人間と，身長1.90 m，体重70 kg の各部位のサイズとした．
投擲物は，野球の硬式球の重さを参考に，0.14 kg とした．
身長1.72 m の人間に基づいた腕の長さと身長1.90 m の人間に基づいた腕の長さでの学習の際に用いる各パラメータの内、各関節に与えるトルクと粘性係数以外のパラメータは\tabref{4.2}に示された2次元剛体2リンクの際と同様とした．また、各関節に与えるトルクと各関節の粘性係数の設定については、投擲物の重さによる比較の際と同様とした。
以上の設定をふまえ，腕の長さに応じた遠投をするための投擲フォームの強化学習を行った際の報酬の遷移を\figref{5.10.eps}に示す．身長1.72 m の人間に基づいた腕の長さによる遠投をするための投擲フォームは2983エピソード，身長1.90 m の人間に基づいた腕の長さによる遠投をするための投擲フォームは3060エピソードを採用した．
\figt{5.10.eps}{width=1.0\hsize}{Reward progress in 3D Rigid 2 Links（left:1.72 m tall human，right:1.90 m tall \newline human）}
\subsection{結果・考察}
初期状態について，投擲物の重さによる投擲フォームの比較と同様に$\theta_{p}$，$\theta_{r}$，$\theta_{y}$，$\theta_{e}$はランダム値，$\dot{\theta}_{p}$，$\dot{\theta}_{r}$，$\dot{\theta}_{y}$，$\dot{\theta}_{e}$は0とした．腕の長さに応じた遠投をするための投擲フォーム戦略の結果・考察について述べる．
\figref{5.11.eps}は強化学習により最適化した，ピッチ軸に垂直な面から見た際の身長1.72 m の人間に基づいた腕の長さによる遠投をするための投擲フォームである．また，\figref{5.16.eps}は強化学習により最適化した，ピッチ軸に垂直な面から見た際の身長1.90 m の人間に基づいた腕の長さによる遠投をするための投擲フォームである．リリース瞬間は，1エピソードの中で最も報酬が高いステップとした．投擲フォームは投擲開始からリリースまでとし，リリース瞬間の肩関節3軸周りと肘関節の角度，手先の高さ，手先速度，投射角，投擲物の飛距離を\tabref{5.7}に示す．身長1.72 m の人間に基づいた腕の長さによる遠投をするための投擲フォームのリリース瞬間は0.489 s，身長1.90 m の人間に基づいた腕の長さによる遠投をするための投擲フォームのリリース瞬間は1.109 sであった．
\begin{table}[tb]
  \begin{center}
    \caption{Data at the release moment of 3D Rigid 2 Links（1.72 m vs 1.90 m）}
    \tablabel{5.7}
    \scalebox{0.8}[0.8]{
    \begin{tabular}{c|c|c|c}
      \hline
      Parameters & Unit & Values of 1.72 m & Values of 1.90 m \\
      \hline
      $\theta_{p}$ & deg & $-125.11$ & $-102.55$ \\
      $\theta_{r}$ & deg & $-136.91$ & $-135.31$ \\
      $\theta_{y}$ & deg  & 36.30 & 65.46 \\
      $\theta_{e}$ & deg & $-23.52$ & $-8.10$ \\
      $h$ & m & 1.96 & 2.04 \\
      $v_{syn}$ & m/s & 26.00 & 29.87 \\
      $\theta_{v}$ & deg & 48.27 & 47.92 \\
      $D$ & m & 70.17 & 92.16 \\
      \hline
    \end{tabular}
    }
  \end{center}
\end{table}
\figref{5.8.eps}は投擲開始からリリースまでの肩関節3軸周り，肘関節周りのトルクの推移，\figref{5.8.eps}は投擲開始からリリースまでの肩関節3軸周り，肘関節周りの角速度の推移，\figref{5.8.eps}は投擲開始からリリースまでの手先速度の推移である．\figref{5.8.eps}において，左図は身長1.72 m の人間に基づいた腕の長さによる遠投をするための投擲フォームの各時系列，右図は身長1.90 m の人間に基づいた腕の長さによる遠投をするための投擲フォームの各時系列である．\\
比較の結果，身長1.72 m の人間に基づいた腕の長さの 0.28 s からリリースまでの投擲フォームと身長1.90 m の人間に基づいた腕の長さの 0.80 s からリリースまでの投擲フォームが類似していた．また，\figref{5.25.eps}は\figref{5.8.eps}の中でも投擲フォームが類似していた区間に着目したトルクの時系列であるが，各関節類似した傾向がみられた．よって，腕の長さに問わず遠投をするための投擲フォームの戦略は同様であると考えられる．しかし，身長1.90 m の人間に基づいた腕の長さによる遠投をするための投擲フォームは 0.80 s の姿勢になるまでに，身長1.72 m の人間に基づいた腕の長さによる遠投をするための投擲フォームとは異なる挙動がみられた．これは，慣性モーメントの影響が考えられる．腕が長くなるとモーメントアームが大きくなるため，腕を回転させるのに必要なトルクが大きくなる．本検証で用いたトルクは身長1.72 m の人間に基づいた腕を回転させるのには十分なトルクであるが，身長1.90 m の人間に基づいた腕をそのまま後方に引くにはトルクが不十分であったと考えられる．肘関節に入力されるトルクが約 0.30 s まで負の値，つまり肘の角速度が負となる方向であり，そこからトルクが正の値となり肘の角速度が正となる．これは肘を屈曲させてから伸展させる動作であり，この動作によって腕を振り上げるためのエネルギーを大きくしていると考えられる．\\
　以上より，身長1.72 m の人間に基づいた腕の長さによる遠投をするための投擲フォームと身長1.90 m の人間に基づいた腕の長さによる遠投をするための投擲フォームの比較によりみられる戦略は，ともに運動連鎖による肩関節の回転を重要視した戦略が考えられる．
\figt{5.16.eps}{width=1.0\hsize}{Throwing form from start to release of 3D Rigid 2 Links from a plane perpendicular to the pitch axis（0.14 kg thrown object，1.90 m tall human）}
\fig{5.8.eps}{width=1.0\hsize}{Transition of shoulder and elbow torque of 3D Rigid 2 Links from start to release （left:1.72 m tall human，right:1.90 m tall human）}
\fig{5.23.eps}{width=1.0\hsize}{Transition of shoulder 3 degrees of freedom and elbow 1 degree of freedom angular velocity from start to release of 3D Rigid 2 Links（left:1.72 m tall human，right:1.90 m tall human）}
\section{結論および今後の展望}
本研究では投擲物の重さや身体のパラメータに応じた投擲フォームを導出・比較することで，パラメータに応じた投擲フォーム戦略の違いを考察した．まず，剛体1リンクモデルにより強化学習を用いたリンク速度最適化シミュレーションを行うことで，自作した強化学習シミュレータと手法の有用性を確認した．その後，腕に見立てた2次元剛体2リンクモデルへと拡張し，投擲物の重さや腕の長さに応じた投擲フォーム戦略の考察を行い，パラメータによって投擲フォーム戦略に違いが生じることを確認した．その後，より人間に近い3次元の腕モデルへと拡張し，投擲物の重さや腕の長さに応じた投擲フォーム戦略について考察を行った．投擲物の重さに応じた遠投をするための投擲フォーム戦略の比較の結果，腕の押し出し度合いによる戦略の違いがみられた．また，腕の長さに応じた遠投をするための投擲フォーム戦略の比較の結果，投擲開始から慣性モーメントの影響により挙動に違いが生じたが，ともに運動連鎖による肩関節の回転を重要視した戦略がみられた．\\
今後の展望として，深層強化学習を用いたトルクの連続値入力による学習，変更する投擲物の重さや身体のパラメータの種類の増加がある．また，本研究では腕による投擲フォーム戦略の考察を行ったが，2次元から3次元の拡張で新たに追加された要素によって新たな戦略もみられた．そのため，全身モデルでの学習による投擲フォーム戦略の考察により，全身の運動連鎖の傾向等，より実際の人間に近い投擲フォーム戦略の考察が可能であると考えられる．加えてさまざまなスポーツに応じたルール制約を設けた学習により，実際の競技や個人に応じた投擲フォーム戦略がみられると考えられる．
%% \begin{thebibliography}{99}
%% \small
%%  \setlength{\kanjiskip}{0.0zw plus.01zw} %
%%  \setlength{\baselineskip}{9pt}        %
%%  \setlength{\itemsep}{0.2pt}             %
%%  \setlength{\lineskip}{0pt}              %
%%  \setlength{\normallineskip}{0.2pt}      %


%% \bibitem{hogege} 川村マサキ，
%% ほげの可能性と適用限界に関する実験的研究，日本ほげ学会ほげ工学部門講演会，(2010)．


%% \bibitem{hohoge} 本堂貴敏，
%% ほげの力学，(2006)，pp.11--43，ほげ出版．

%% \end{thebibliography}

{
%% \scriptsize %%←どうしても入らない時は，このコメントをはずすと少し小さくなる．
\bibliographystyle{junsrt}
\bibliography{reference}
}

\end{small}
\end{document}
