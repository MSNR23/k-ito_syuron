\chapter[2次元剛体2リンクによるパラメータに応じた投擲フォームの導出・比較と戦略の考察]{2次元剛体2リンクによるパラメータに応じた投擲フォームの導出・比較と戦略の考察}

\section{はじめに}
本章では，2次元モデルによる投擲物の重さに応じた遠投をするための投擲フォームの導出・比較により，考察した投擲フォーム戦略について述べる．同様に腕の長さに応じた遠投をするための投擲フォームの比較により，考察した投擲フォーム戦略について述べる．
\section{動力学モデル}
本章の検証で用いた動力学モデルを\figref{4.0.eps}に示す．人間の腕を肩関節1自由度と肘関節1自由度の計2自由度から構成される2次元剛体2リンクとしてモデル化した．\\
　ラグランジュの方法を用いて導いた2次元剛体2リンクの運動方程式は，次の通りである．\\
各リンクの重心位置$o_{s_{1}}$,$o_{s_{2}}$は，

\fig{4.0.eps}{width=1.0\hsize}{2D Rigid 2 Links}

\begin{eqnarray}
  o_{s_{1}} = 
              \begin{bmatrix}
              l_{g1}\cos\theta_{1}\\
              l_{g1}\sin\theta_{1}
              \end{bmatrix}
\end{eqnarray}

\begin{eqnarray}
  o_{s_{2}} = 
              \begin{bmatrix}
              l_{1}\cos\theta_{1} + l_{g2}\cos(\theta_{1} + \theta_{2})\\
              l_{1}\sin\theta_{1} + l_{g2}\sin(\theta_{1} + \theta_{2})
              \end{bmatrix}
\end{eqnarray}

微分すると，

\begin{eqnarray}
  o_{\dot{s}_{1}} = 
              \begin{bmatrix}
              -l_{g1}\sin\theta_{1} \cdot \dot{\theta}_{1}\\
              l_{g1}\cos\theta_{1} \cdot \dot{\theta}_{1}
              \end{bmatrix}
\end{eqnarray}
\begin{eqnarray}
  o_{\dot{s}_{2}} = 
              \begin{bmatrix}
                -l_{1}\sin\theta_{1} \cdot \dot{\theta}_{1} - l_{g2}\sin(\theta_{1} + \theta_{2}) \cdot (\dot{\theta}_{1} + \dot{\theta}_{2})\\
                l_{1}\cos\theta_{1} \cdot \dot{\theta}_{1} + l_{g2}\cos(\theta_{1} + \theta_{2}) \cdot (\dot{\theta}_{1} + \dot{\theta}_{2})
              \end{bmatrix}
\end{eqnarray}

剛体2リンク全体の並進運動エネルギー$E_{t}$は，各リンクの並進運動エネルギーの合計とすると，

\begin{eqnarray}
  E_{t}
  &=&\frac{1}{2}m_{1}o_{\dot{s}_{1}}{}^T\!o_{\dot{s}_{1}} + \frac{1}{2}m_{2}o_{\dot{s}_{2}}{}^T\!o_{\dot{s}_{2}} \nonumber \\
  &=&\frac{1}{2}m_{1}{l_{g1}}^2{\dot{\theta}_{1}}^2 + \frac{1}{2}m_{2}({{l_{1}}^2}{\dot{\theta}_{1}}^2 + {l_{g2}}^2(\dot{\theta}_{1} + \dot{\theta}_{2})^2 + 2{l_{1}}{l_{g2}}\cos({\dot{\theta}_{1}}^2 + \dot{\theta}_{1}\dot{\theta}_{2}))
\end{eqnarray}

同様に，回転運動エネルギー$E_{r}$は，

\begin{eqnarray}
  E_{r}
  =\frac{1}{2}I_{1}{\dot{\theta}_{1}}^2 + \frac{1}{2}I_{2}(\dot{\theta}_{1} + \dot{\theta}_{2})^2
\end{eqnarray}

よって，全体の運動エネルギー$E_{k}$は，

\begin{eqnarray}
  E_{k}
  =E_{t} + E_{r}
\end{eqnarray}

重力によって生じる位置エネルギーについて，重力方向をg = ${[0 \quad -g]}^T$とすると，上腕リンクの位置エネルギー$E_{p1}$は，

\begin{eqnarray}
  E_{p1}
  =m_{1}gl_{g1}\sin\theta_{1}
\end{eqnarray}

前腕リンクの位置エネルギー$E_{p2}$は，

\begin{eqnarray}
  E_{p1}
  =m_{2}g(l_{1}\sin\theta_{1} + l_{g2}\sin(\theta_{1} + \theta_{2}))
\end{eqnarray}

全体の位置エネルギー$E_{p}$は，

\begin{eqnarray}
  E_{p}
  =E_{p1} + E_{p2}
\end{eqnarray}

ここで，ラグランジュ関数$L$を

\begin{eqnarray}
  L
  =E_{k} - E_{p}
\end{eqnarray}

とする．ラグランジュ関数$L$を求め，\equref{3.8}に代入すると，$\theta_{1}$についての運動方程式

\begin{eqnarray}
  &&(m_{1}{l_{g1}}^2 + I_{1} + m_{2}({l_{1}}^2 + {l_{g2}}^2)
  + 2l_{1}l_{g2}\cos\theta_{2})\ddot{\theta_{1}} \nonumber \\
  &+& (m_{2}({l_{g2}}^2 + l_{1}l_{g2}\cos\theta_{2}) + I_{2})\ddot{\theta_{2}} \nonumber \\
  &-& m_{2}l_{1}l_{g2}\sin\theta_{2}(2\dot{\theta_{1}}\dot{\theta_{2}} + {\dot{\theta_{2}}}^2)  \nonumber \\
  &+& m_{1}gl_{g1}\cos\theta_{1} + m_{2}g(l_{1}\cos\theta_{1} + l_{g2}\cos(\theta_{1} + \theta_{2})) = \tau_{1}
\end{eqnarray}

$\theta_{2}$についての運動方程式

\begin{eqnarray}
  &&(m_{2}({l_{g2}}^2 + l_{1}l_{g2}\cos\theta_{2}) + I_{2})\ddot{\theta_{1}} + (m_{2}{l_{g2}}^2 + I_{2})\ddot{\theta_{2}} \nonumber \\
  &+& m_{2}l_{1}l_{g2}\sin\theta_{2}{\dot{\theta_{1}}}^2 + m_{2}gl_{g2}\cos(\theta_{1} + \theta_{2}) = \tau_{2}
\end{eqnarray}

を得る．これらを整理すると以下の式となる．

\begin{eqnarray}
  M(\theta)\ddot{\theta} + h(\theta, \dot{\theta}) + g(\theta) + b(\dot{\theta}) = \tau
\end{eqnarray}

このとき，$\theta$=${[\theta_{1} \quad \theta_{2}]}^T$，$\tau$=${[\tau_{1} \quad \tau_{2}]}^T$であり，粘性を考慮すると，

\begin{align}
  M(\theta)= 
            \begin{bmatrix}
              m_{1}{l_{g1}}^2 + I_{1} + m_{2}({l_{1}}^2 + {l_{g2}}^2 + 2l_{2}l_{g2}\cos\theta_{2}) + I_{2} & m_{2}({l_{g2}}^2 + l_{1}l_{g2}\cos\theta_{2}) + I_{2} \\
              m_{2}({l_{g2}}^2 + l_{1}l_{g2}\cos\theta_{2}) + I_{2} & m_{2}{l_{g2}}^2 + I_{2}
            \end{bmatrix}
\end{align}

\begin{eqnarray}
  h(\theta, \dot{\theta})=
            \begin{bmatrix}
              -m_{2}l_{1}l_{g2}\sin\theta_{2}(2\dot{\theta_{1}}\dot{\theta_{2}} + {\dot{\theta_{2}}}^2) \\
              m_{2}l_{1}l_{g2}\sin\theta_{2}\cdot{\dot{\theta_{1}}}^2
            \end{bmatrix}
\end{eqnarray}

\begin{eqnarray}
  g(\theta)=
            \begin{bmatrix}
              m_{1}gl_{g1}\cos\theta_{1} + m_{2}g(l_{1}\cos\theta_{1} + l_{g2}\cos(\theta_{1} + \theta_{2})) \\
              m_{2}gl_{g2}\cos(\theta_{1} + \theta_{2})
            \end{bmatrix}
\end{eqnarray}

\begin{eqnarray}
  b(\dot{\theta})=
            \begin{bmatrix}
              b_{1}\dot{\theta_{1}} \\
              b_{2}\dot{\theta_{2}}
            \end{bmatrix}
\end{eqnarray}

$M(\theta)$は慣性行列，$h(\theta, \dot{\theta})$はコリオリ力の項，$g(\theta)$は重力項，$b(\dot{\theta})$は粘性項である．

\section{シミュレータの作成}
2次元剛体2リンクを強化学習するためのシミュレータをpythonで実装した．シミュレータでは導出した運動方程式をRunge-Kutta法\cite{runge-kutta}により数値積分し運動学を解くことで，2次元剛体2リンクの角度や角速度を計算する．Runge-Kutta法は常微分方程式を解く手法の1つであり，Euler法は$\Delta T$を1桁細かくすると誤差を1桁減少させるのに対し，Runge-Kutta方は誤差を4桁減少させることができる．
\section{強化学習の設定}
\subsection{状態}
状態変数は4つとし，肩関節の角度$\theta_{1}$，角速度$\dot{\theta}_{1}$，肘関節の角度$\theta_{2}$，角速度$\dot{\theta}_{2}$とした．\\
各関節の角度の可動範囲は，$-180$ deg $\le$ $\theta_{1}$ $\le$ $180$ deg，$0$ $\le$ $\theta_{2}$ $\le$ $150$ deg\cite{range}とした．
肩関節は本来3自由度でありピッチ軸周りの可動範囲は設定した可動範囲より小さい．しかし，ロール軸，ヨー軸の可動範囲の影響により肩がピッチ軸周りに$360$ deg 回転しているように見える．よって，本章は2次元でのシミュレーションのため，上記の可動範囲とした．
また，各リンクの角速度については，$-10.0$ m/s $\le$ $\dot{\theta}_{1}$ $\le$ $10.0$ m/s，$-10.0$ m/s $\le$ $\dot{\theta}_{2}$ $\le$ $10.0$ m/sとした．
分割数は各状態4分割であり，全ての状態を$4^{4}$=256通りで表すことができる．
\subsection{行動}
行動は，全9通りに設定した．肩関節にかかるトルクを正，0，負の3通り，同様に肘関節にかかるトルクも正，0，負の3通りとした．
これにより，Qテーブルは$256 \times 9=2304$通りで表すことができる．
\subsection{報酬}
報酬は，リリース時の投射角度$\theta_{v}$と手先速度$v_{2}$の2つの要素から設定した．リリースの投射角度$\theta_{v}$について，\equref{2.19}で計算した．
\begin{eqnarray}
  \equlabel{2.19}
  \theta_{v}=\theta_{1}+\theta_{2}-90
\end{eqnarray}
\equref{2.19}において，$\theta_{v}$，$\theta_{1}$，$\theta_{2}$の単位はdegである．
また，条件は以下の通りとした．\\
\begin{itemize}
  \item $0$ $\le$ $\theta_{v}$ $\le$ $45$ degのとき，$\frac{\theta_{v}}{45}$
  \item $45$ deg $\le$ $\theta_{v}$ $\le$ $90$ degのとき，$\frac{90-\theta_{v}}{45}$
  \item $90$ deg $\le$ $\theta_{v}$ $\le$ $135$ degのとき，$\frac{\theta_{v}-90}{45}$
  \item $135$ deg $\le$ $\theta_{v}$ $\le$ $180$ degのとき，$\frac{180-\theta_{v}}{45}$
  \item $\theta_{v}$ $\le$ $0$，$180$ $\le$ $\theta_{v}$のとき，$0$\\
\end{itemize}

この条件により，$\theta_{v}$が$45$ degまたは$135$ degの際に報酬最大となる．これは，投擲物の遠投時に最も有効な角度\cite{angle}である．
これらの角度からリリース時の角度が離れるにつれて報酬が小さくなっていく．
よって投擲方向は指定せずにより投擲物の飛距離を大きくするためのリリースポイントの報酬を大きくすることができる．\\
　手先速度$v_{2}$について，

\begin{eqnarray}
  \equlabel{2.20}
  {v_{x2}}^2=-l_{1}\sin\theta_{1}\cdot\dot{\theta}_{1}-l_2\sin(\theta_{1}+\theta_{2})\cdot(\dot{\theta}_{1}+\dot{\theta}_{2})
\end{eqnarray}

\begin{eqnarray}
  \equlabel{2.21}
  {v_{y2}}^2=-l_{1}\cos\theta_{1}\cdot\dot{\theta}_{1}+l_2\cos(\theta_{1}+\theta_{2})\cdot(\dot{\theta}_{1}+\dot{\theta}_{2})
\end{eqnarray}

\equref{2.20}，\equref{2.21}より，

\begin{eqnarray}
  \equlabel{2.22}
  v_{2}=\sqrt{{v_{x2}}^2+{v_{y2}}^2}
\end{eqnarray}

で求めた．\\

以上の2つの要素より，報酬は$\theta_{v} \times v_{2}$と設定した．この設定により，遠投を行うための投擲フォームを獲得することができる．
また，リリース時の投射角と手先速度の積とすることで，どちらの要素にも報酬に対する重みを付与することができる．\\
　さらに効率的に投擲フォームを獲得するために，罰則として累積消費エネルギーを採用し，\equref{2.25}で計算した．

\begin{eqnarray}
  \equlabel{2.23}
  CE_{1}&=&\int \tau_{1}(t)\cdot\dot{\theta}_{1} dt \nonumber \\
        &\approx&|\tau_{1}(t)\cdot\dot{\theta}_{1}|\cdot\Delta t
\end{eqnarray}

\begin{eqnarray}
  \equlabel{2.24}
  CE_{2}&=&\int \tau_{2}(t)\cdot\dot{\theta}_{2} dt \nonumber \\
        &\approx&|\tau_{2}(t)\cdot\dot{\theta}_{2}|\cdot\Delta t
\end{eqnarray}

\equref{2.23}，\equref{2.24}より，

\begin{eqnarray}
  \equlabel{2.25}
  CE = CE_{1} + CE_{2}
\end{eqnarray}

$\tau_{1}$は肩関節に与えるトルク，$\tau_{2}$は肘関節に与えるトルクである．これは，1エピソード内においてステップごとに消費するエネルギーを計算し，それを加算したものである．
累積消費エネルギーはステップを重ねるごとに大きくなるため，1エピソードの内，最終ステップが最も大きくなる．
シミュレーション上では肩関節を回し続けるほど手先速度は大きくなると考えられるが，実際の投擲動作では人間の疲労を考慮する必要がある．
そのため，累積消費エネルギーを罰則として採用することは，疲労を再現することを期待できる．\\
　以上より，報酬の設計は，

\begin{eqnarray}
  \equlabel{2.26}
  Reward = \theta_{v} \times v_{2} - scale \times CE
\end{eqnarray}

$scale$は累積消費エネルギーの値を調整するものである．累積消費エネルギーの値が大きすぎると1ステップごとの報酬が微小となる，あるいはマイナスとなっていくため，初期姿勢のまま動作せずエネルギー消費をしないことを最適として学習する．そのため$scale$によって累積消費エネルギーの大きさを調整する必要があるが，反対に$scale$が大きすぎて累積消費エネルギーが小さくなると疲労を考慮しない投擲フォームが導出されるため，値の調整が重要である．
\subsection{その他}
本章では，\equref{Q}における学習率$\alpha$を$0.1$，割引率$\gamma$を$0.9$に設定した．これは将来の報酬を優先的に考慮した学習を期待するためである．
1タイムステップは$0.005$ sであり，1エピソード内のステップ数は2000，すなわち，$10$ sとした．エピソード数に関しては，学習が収束するまで際限なく行うものとした．
\section{投擲物の重さに応じた最適投擲フォームの比較}
\subsection{シミュレーション設定}
本検証で用いたパラメータを\tabref{4.1}に示す\cite{irving}．$b_{1}$，$b_{2}$は，各関節の粘性係数である．身体のサイズは，身長 1.72 m，体重 70 kgの人間の各部位のサイズとした．
投擲物は，野球の硬式球と砲丸の重さを参考に，$0.14$ kg\cite{horiuchi} と$7.24$ kg\cite{haq} とした．
\begin{table}[tb]
  \begin{center}
    \caption{Parameters which are used for 2D Rigid 2 Links simulation（0.14 kg vs 7.24 kg）}
    \tablabel{4.1}
    \begin{tabular}{c|c|c}
      \hline
      Parameters & Unit & Values \\
      \hline
      $l_{1}$ & m & 0.32 \\
      $l_{2}$ & m & 0.44 \\
      $l_{f}$ & m & 0.25 \\
      $l_{h}$ & m & 0.19 \\
      $m_{f}$ & kg & 1.12 \\
      $m_{h}$ & kg & 0.42 \\
      $m_{o}$ & kg & 0.14 or 7.24 \\
      $m_{1}$ & kg & 1.96 \\
      $m_{2}$ & kg & 1.68 or 8.78 \\
      $b_{1}$ &  & 0.05 \\
      $b_{2}$ &  & 0.01 \\
      \hline
    \end{tabular}
  \end{center}
\end{table}
重力加速度$g$を9.8 $\mathrm{m/s^{2}}$とする．また，本検証では前腕と手と投擲物の要素を合わせて前腕リンクとしてみなすため，3つの要素を考慮して設定を行った．
前腕の要素として，$l_{f}$を前腕長さ，$m_{f}$を前腕重さ，$l_{h}$を手長さ，$m_{h}$を手重さとした．\\
上腕リンクの重心までの長さ$l_{g1}$，前腕リンクの重心までの長さ$l_{g2}$を，\equref{2.27}，\equref{2.28}により計算した．
\begin{eqnarray}
  \equlabel{2.27}
  l_{g1}=\frac{1}{2}l_{1}
\end{eqnarray}

\begin{eqnarray}
  \equlabel{2.28}
  l_{g2}=\frac{\frac{1}{2}m_{f}l_{f}+m_{h}(l_{f}+\frac{1}{2}l_{h}+m_{o}l_{2})}{m_{2}}
\end{eqnarray}

上腕リンクの慣性モーメント$I_{1}$と前腕リンクの慣性モーメント$I_{2}$を\equref{2.29}，\equref{2.30}により計算した．
\begin{eqnarray}
  \equlabel{2.29}
  I_{1}=\frac{1}{12}m_{1}{l_{1}}^{2}
\end{eqnarray}
\begin{eqnarray}
  \equlabel{2.30}
  I_{2}=\frac{1}{12}m_{f}{l_{f}}^{2}+m_{f}{l_{g1}}^{2}+\frac{1}{12}m_{h}{l_{h}}^{2}+m_{h}{l_{g2}}^{2}+m_{o}{l_{2}}^{2}
\end{eqnarray}

各ステップで与えるトルクについて，肩関節に与えるトルク$\tau_{1}$を\equref{2.31}，肘関節に与えるトルク$\tau_{2}$を\equref{2.32}を基に計算した．

\begin{eqnarray}
  \equlabel{2.31}
  \tau_{1} = \tau_{2} + m_{1}gl_{1}\cos(\theta_{1} + \theta_{2})
\end{eqnarray}

\begin{eqnarray}
  \equlabel{2.32}
  \tau_{2} = (m_{2} + m_{o})gl_{2}\cos(\theta_{1} + \theta_{2})
\end{eqnarray}

腕を360 deg 回転させる際，重力の影響で$\theta_{1}$，$\theta_{2}$が0から90 deg に振り上げる際に最もトルクが必要である．そのため，$\theta_{1}$ = $\theta_{2}$ = 0の際に各関節にかかるトルクを計算し，その計算結果を基に計算した．また，肘関節の可動範囲は0 $\le$ $\theta_{2}$ $\le$ 150 deg であるが，可動範囲の端である$\theta_{2} = 0$ または $\theta_{2} = 150$ degでは，可動範囲内に戻ろうとする力がはたらく．これを考慮し，可動範囲の端では肘関節が可動範囲内に戻る方向に20 N$\cdot$m のトルクを加算する設定とした．

重さ0.14 kg の投擲物と重さ7.24 kg の投擲物での学習の際に用いるそれぞれの\equref{2.27}から\equref{2.32}の計算結果を\tabref{4.2}に示す．

\begin{table}[tb]
  \begin{center}
    \caption{Calculation results of $l_{g1}$,$l_{g2}$,$I_{1}$,$I_{2}$ for 2D Rigid 2 Links（0.14 kg vs 7.24 kg）}
    \tablabel{4.2}
    \begin{tabular}{c|c|c|c}
      \hline
      Parameters & Unit & Values of 0.14 kg & Values of 7.24 kg \\
      \hline
      $l_{g1}$ & m & 0.16 & 0.16 \\
      $l_{g2}$ & m & 0.21 & 0.40 \\
      $I_{1}$ & kg$\cdot$$\mathrm{m}^2$ & 0.017 & 0.017 \\
      $I_{2}$ & kg$\cdot$$\mathrm{m}^2$ & 0.15 & 1.59 \\
      $\tau_{1}$ & N$\cdot$m & $-16, 0, +16$ & $-47, 0, +47 $\\
      $\tau_{2}$ & N$\cdot$m & $-10, 0, +10$ & $-41, 0, +41 $\\
      \hline
    \end{tabular}
  \end{center}
\end{table}

以上の設定により，投擲物の重さに応じた遠投をするための投擲フォームの強化学習を行った際の報酬の遷移を\figref{4.2.eps}に示す．重さ0.14 kg の投擲物を遠投するための投擲フォームは1250エピソード，重さ7.24 kg の投擲物を遠投するための投擲フォームは4000エピソードを採用した．
\fig{4.2.eps}{width=1.0\hsize}{Reward progress in 2D Rigid 2 Links（left: 0.14 kg thrown object，right: 7.24 kg thrown object）}

\subsection{結果・考察}
$\theta_{1}$，$\theta_{2}$，$\dot{\theta}_{1}$，$\dot{\theta}_{2}$の初期状態をいずれも0とした際の投擲物の重さに応じた遠投をするための投擲フォーム戦略の結果・考察について述べる．
\figref{4.3.eps}は強化学習により最適化した，重さ0.14 kg の投擲物を遠投するための投擲フォーム，\figref{4.4.eps}は強化学習により最適化した，重さ7.24 kg の投擲物を遠投するための投擲フォームである．投擲フォームは投擲開始からリリースまでとし，リリース時の姿勢は黒の太枠で囲まれたものである．図中の青リンク，橙リンクがそれぞれ上腕リンク，前腕リンクに対応し，赤線が手先の軌跡を示す．リリース瞬間の肩関節と肘関節の角度，手先速度，投射角を\tabref{4.3}に示す．2つの投擲フォームの比較により，リリース時の肩関節の角度と軌跡の径の大きさに違いがみられた．\\
\begin{table}[tb]
  \begin{center}
    \caption{Data at the moment of release for 2D Rigid 2 Links（0.14 kg vs 7.24 kg）}
    \tablabel{4.3}
    \begin{tabular}{c|c|c|c}
      \hline
      Parameters & Unit & Values of 0.14 kg & Values of 7.24 kg \\
      \hline
      $\theta_{1}$ & deg & $-313.96$ & $-354.51$ \\
      $\theta_{2}$ & deg & 87.71 & 132.32 \\
      $v_{2}$ & m/s & 10.24 & 5.46 \\
      $\theta_{v}$ & deg & 43.76 & 47.81 \\
      \hline
    \end{tabular}
  \end{center}
\end{table}
　また，\figref{4.5.eps}は投擲開始からリリースまでの肩関節・肘関節のトルクの推移，\figref{4.6.eps}は投擲開始からリリースまでの肩関節・肘関節の角速度の推移である．\figref{4.5.eps}，\figref{4.6.eps}の左図が重さ0.14 kg の投擲物を遠投するための投擲フォームの各時系列，右図がの重さ7.24 kg の投擲物を遠投するための投擲フォームの各時系列である．\\
　トルクの時系列より，重さ0.14 kg の投擲物を遠投するための投擲フォームは，肩関節と肘関節の運動連鎖を活かした投擲フォーム戦略の傾向がみられた．投擲開始からまず肩関節のトルクによって腕を回転させる．その後，約0.13 s で肩関節のトルクが腕の回転とは逆方向にトルクが生じ，肘関節のトルクが腕の回転と同方向にトルクが生じリリースを迎える．これは肩関節のエネルギーを肘関節に伝達することでより手先方向のエネルギーを大きくしていると考えられる．また，肩関節と肘関節の角速度の推移より，トルクの入力に運動連鎖の傾向がみられる約0.13 s から肩関節の角速度が減少し肘関節の角速度が増加する．リリース時には肩関節と肘関節の角速度が逆転していることから最後は前腕の振りを如何に大きくするのかが重要であると考えられる．一方，重さ7.24 kg の投擲物を遠投するための投擲フォームは，肩関節による影響が大きい投擲フォームの傾向がみられた．投擲開始から肩関節のトルクによって腕を回転させる傾向は重さ0.14 kg の投擲物の際と同様であるが，肩関節のトルクが0となる瞬間が数回生じ，また肘関節のトルクは肘を屈曲させる方向に生じ続けている．これは，肩関節のトルクによる腕の回転はペナルティである累積消費エネルギーへの影響が大きく，消費を抑制するためであると考えられる．また，肘関節のトルクによって肘を屈曲させ続ける傾向にある理由として，モーメントアームを小さくすることで肩の回転に消費するエネルギーを抑制するためであると考えられる．加えて肩関節と肘関節の角速度の推移より，肘関節の角速度が正となるのが遅く，リリースの瞬間も肩関節の角速度が肘関節の角速度より大きい．すなわち，肩関節の影響が重さ0.14 kg の投擲物を遠投する際よりも大きいと考えられる．\\

\fig{4.3.eps}{width=1.0\hsize}{Throwing form from start to release for 2D Rigid 2 Links（0.14 kg thrown object，\\1.72 m tall human）}
\fig{4.4.eps}{width=1.0\hsize}{Throwing form from start to release for 2D Rigid 2 Links（7.24 kg thrown object）}
\clearpage
\figp{4.5.eps}{width=1.0\hsize}{Transition of shoulder and elbow torque from start to release for 2D Rigid 2 Links\\（left: 0.14 kg thrown object，right: 7.24 kg thrown object）}
\figp{4.6.eps}{width=1.0\hsize}{Transition of shoulder and elbow angular velocity from start to release for 2D Rigid 2 Links（left: 0.14 kg thrown object，right: 7.24 kg thrown object）}

\clearpage
\section{腕の長さに応じた最適投擲フォームの比較}
\subsection{シミュレーション設定}
本検証で用いたパラメータを\tabref{4.4}に示す．身体のサイズは，身長1.72 m または 1.90 m ，体重70 kgの人間の各部位のサイズとした．
投擲物は，野球の硬式球を参考に，0.14 kgとした．
\begin{table}[tb]
  \begin{center}
    \caption{Parameters which are used for 2D Rigid 2 Links simulation（1.72 m vs 1.90 m）}
    \tablabel{4.4}
    \begin{tabular}{c|c|c}
      \hline
      Parameters & Unit & Values \\
      \hline
      $l_{1}$ & m & 0.32 or 0.35 \\
      $l_{2}$ & m & 0.44 or 0.48 \\
      $l_{f}$ & m & 0.25 or 0.28 \\
      $l_{h}$ & m & 0.19 or 0.20 \\
      $m_{f}$ & kg & 1.12 \\
      $m_{h}$ & kg & 0.42 \\
      $m_{o}$ & kg & 0.14 \\
      $m_{1}$ & kg & 1.96 \\
      $m_{2}$ & kg & 1.68 \\
      $b_{1}$ &  & 0.05 \\
      $b_{2}$ &  & 0.01 \\
      \hline
    \end{tabular}
  \end{center}
\end{table}


身長1.72 m の人間に基づいた腕の長さでの投擲の際と身長1.90 m の人間に基づいた腕の長さでの投擲の際の，それぞれの\equref{2.27}から\equref{2.32}の計算結果を\tabref{4.5}に示す．重力加速度，可動範囲の端での肩関節と肘関節に加算するトルクは，4.4.1節と同様の設定とした．

\begin{table}[tb]
  \begin{center}
    \caption{Calculation results of $l_{g1}$,$l_{g2}$,$I_{1}$,$I_{2}$ for 2D Rigid 2 Links（1.72 m vs 1.90 m）}
    \tablabel{4.5}
    \begin{tabular}{c|c|c|c}
      \hline
      Parameters & Unit & Values of 1.72 m & Values of 1.90 m \\
      \hline
      $l_{g1}$ & m & 0.16 & 0.18 \\
      $l_{g2}$ & m & 0.21 & 0.23 \\
      $I_{1}$ & kg$\cdot$$\mathrm{m}^2$ & 0.017 & 0.018 \\
      $I_{2}$ & kg$\cdot$$\mathrm{m}^2$ & 0.020 & 0.099 \\
      $\tau_{1}$ & N$\cdot$m & $-16, 0, +16$ & $-18, 0, +18$ \\
      $\tau_{2}$ & N$\cdot$m & $-10, 0, +10$ & $-11, 0, +11$ \\
      \hline
    \end{tabular}
  \end{center}
\end{table}

腕の長さに応じた投擲フォームの強化学習を行った際の報酬の遷移を\figref{4.4.eps}に示す．身長1.72 m の人間に基づいた腕の長さによる投擲フォームは1250エピソード，身長1.90 m の人間に基づいた腕の長さによる投擲フォームは2070エピソードを採用した．

\figt{4.7.eps}{width=1.0\hsize}{Reward progress in 2D Rigid 2 Links（left:1.72 m tall human，right:1.90 m tall human）}

\subsection{結果・考察}
$\theta_{1}$，$\theta_{2}$，$\dot{\theta}_{1}$，$\dot{\theta}_{2}$の初期状態をいずれも0とした際の腕の長さに応じた遠投をするための投擲フォーム戦略の結果・考察について述べる．
\figref{4.2.eps}は強化学習により最適化した，身長1.72 m の人間に基づいた腕の長さによる遠投をするための投擲フォーム，\figref{4.8.eps}は強化学習により最適化した，身長1.90 m の人間に基づいた腕の長さによる遠投をするための投擲フォームである．投擲フォームは投擲開始からリリースまでとし，リリース時の姿勢は黒の太枠で囲まれたものである．図中の青リンク，橙リンクがそれぞれ上腕リンク，前腕リンクに対応し，赤線が手先の軌跡を示す．リリース瞬間の肩関節と肘関節の角度，手先速度，投射角を\tabref{4.6}に示す．2つの投擲フォームの比較により，投擲物の重さによる比較と同様に，リリース時の肩関節の角度と軌跡の径の大きさに違いがみられた．

\begin{table}[tb]
  \begin{center}
    \caption{Data at the moment of release for 2D Rigid 2 Links（1.72 m vs 1.90 m）}
    \tablabel{4.6}
    \begin{tabular}{c|c|c|c}
      \hline
      Parameters & unit & Values of 1.72 m & Values of 1.90 m \\
      \hline
      $\theta_{1}$ & deg & $-313.96$ & $-338.49$ \\
      $\theta_{2}$ & deg & 87.71 & 119.67 \\
      $v_{2}$ & m/s & 10.24 & 13.95 \\
      $\theta_{v}$ & deg & 43.76 & 51.18 \\
      \hline
    \end{tabular}
  \end{center}
\end{table}

また，\figref{4.9.eps}は投擲開始からリリースまでの肩関節・肘関節のトルクの推移，\figref{4.10.eps}は投擲開始からリリースまでの肩関節・肘関節の角速度の推移である．\figref{4.9.eps}，\figref{4.10.eps}の左図が身長1.72 m の人間に基づいた腕の長さによる遠投をするための投擲フォームの各時系列，右図が身長1.90 m の人間に基づいた腕の長さによる遠投をするための投擲フォームの各時系列である．\\
　トルクの時系列より，身長1.90 m の人間に基づいた腕の長さによる遠投をするための投擲フォームは，身長1.72 m の人間に基づいた腕の長さによる遠投をするための投擲フォームと同様に運動連鎖を活かした投擲フォーム戦略の傾向がみられた．しかし，投擲開始から肩関節のトルクによって腕を回転させる傾向は同様であるが，身長1.90 m の人間に基づいた腕の長さによる遠投をするための投擲フォームは肘関節のトルクを腕の回転方向とは反対の，肘関節を屈曲させる方向へ生じさせている．これはモーメントアームによる影響が考えられる．モーメントアームが大きいと腕の回転に必要な肩関節のトルクが大きくなるが，その分エネルギーを消費する．今回設定したトルクの大きさでは，肘を伸ばしたまま腕を回転させるよりも肘を屈曲してモーメントアームを小さくして腕を回転させる方がエネルギー消費が少なく腕を回転させることができると考えられる．また，腕の長さに問わずリリース時には肘関節の角速度が肩関節の角速度を上回ることから，リリース直前に運動連鎖によってより肘関節の角速度を大きくしようとすると考えられる．

\figp{4.8.eps}{width=1.0\hsize}{Throwing form from start to release for 2D Rigid 2 Links（1.90 m tall human）}
\clearpage
\figp{4.9.eps}{width=1.0\hsize}{Transition of shoulder and elbow torque from start to release for 2D Rigid 2 Links（left:1.72 m tall human，right:1.90 m tall human）}
\figp{4.10.eps}{width=1.0\hsize}{Transition of shoulder and elbow angular velocity from start to release for 2D Rigid 2 Links（left:1.72 m tall human，right:1.90 m tall human）}

% \begin{figure}[tbp]
%   \centering
%   \includegraphics[width=0.8\hsize]{fig/4.10.eps} % 画像のパスを指定
%   \caption{Angular velocity of shoulder and elbow torque from start to release for\\2D rigid 2 links（left:1.72 m tall human，right:1.90 m tall human）}
%   \figlabel{Fitting}
% \end{figure}

% \begin{figure}[tbp]
%   \begin{minipage}[tb]{1.0\hsize}
%       \vspace{-3mm}
%       \centering
%       \includegraphics[width=.8\hsize]{./fig/4.10.eps}
%       \vspace{-2mm}
%       \caption{Experimental\\Environment}
%       \figlabel{end_effector_big.pdf}
%   \end{minipage}
%   \vspace{-3mm}
%   \hspace*{2mm}%
% %   \begin{minipage}[tb]{0.4\hsize}
% %     \centering
% %     % \includegraphics[width=.9\hsize,angle=-90]{./fig/experimental_environment.JPG}
% %     \includegraphics[width=.9\hsize]{./fig/exp_env2.JPG}
% %     \vspace{-1mm}
% %     \caption{Experimental\\Environment}
% % %     \vspace{-1mm}
% %     \figlabel{experimental_environment.JPG}
% %   \end{minipage}
% %   % \caption{Conditions for each object manipulation technique}
% %   % \figlabel{simple_drawer}
% %   \vspace{-3mm}
% \end{figure}
